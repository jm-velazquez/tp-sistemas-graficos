(()=>{"use strict";var t="undefined"!=typeof Float32Array?Float32Array:Array;function e(){var e=new t(16);return t!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}Math.random,Math.PI,Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var r=function(t,e,r,n,i){var o,a=1/Math.tan(e/2);return t[0]=a/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(o=1/(n-i),t[10]=(i+n)*o,t[14]=2*i*n*o):(t[10]=-1,t[14]=-2*n),t};function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}function i(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,a(n.key),n)}}function o(t,e,r){return(e=a(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function a(t){var e=function(t,e){if("object"!=n(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,"string");if("object"!=n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==n(e)?e:e+""}var u=function(){return t=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),o(this,"radius",void 0),o(this,"definition",void 0),this.radius=e,this.definition=r},(e=[{key:"getPosition",value:function(t){var e=2*t*Math.PI,r=this.radius*Math.cos(e),n=this.radius*Math.sin(e);return glMatrix.vec4.fromValues(r,n,0,1)}},{key:"getArrays",value:function(){for(var t=1/this.definition,e=[],r=[],n=[],i=0;i<=this.definition;i++){var o=this.getPosition(i*t),a=glMatrix.vec4.create();glMatrix.vec4.normalize(a,o),e.push(o),r.push(a),n.push(o[0]/this.radius+this.radius,o[1]/this.radius+this.radius)}return{positionArray:e,normalArray:r,uvArray:n}}}])&&i(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function s(t){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s(t)}function l(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,c(n.key),n)}}function f(t,e,r){return(e=c(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function c(t){var e=function(t,e){if("object"!=s(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=s(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==s(e)?e:e+""}var h=function(){return t=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,u=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),f(this,"positionBuffer",null),f(this,"normalBuffer",null),f(this,"uvBuffer",null),f(this,"indexBuffer",null),f(this,"texture",null),f(this,"affectedByLighting",void 0),f(this,"children",[]),f(this,"modelMatrix",glMatrix.mat4.create()),f(this,"translationVector",[0,0,0]),f(this,"rotationAxis",[1,0,0]),f(this,"rotationDegree",0),f(this,"scalingVector",[1,1,1]),f(this,"drawMode",null),f(this,"normalMap",void 0),this.drawMode=e,this.positionBuffer=r,this.normalBuffer=n,this.indexBuffer=i,this.uvBuffer=o,this.texture=a,this.affectedByLighting=u,this.normalMap=s,glMatrix.mat4.identity(this.modelMatrix)},e=[{key:"addChild",value:function(t){this.children.push(t)}},{key:"updateModelMatrix",value:function(){glMatrix.mat4.translate(this.modelMatrix,this.modelMatrix,this.translationVector),glMatrix.mat4.rotate(this.modelMatrix,this.modelMatrix,this.rotationDegree,this.rotationAxis),glMatrix.mat4.scale(this.modelMatrix,this.modelMatrix,this.scalingVector)}},{key:"getWorldCoordinates",value:function(t){this.updateModelMatrix();var e=glMatrix.mat4.create();glMatrix.mat4.multiply(e,t,this.modelMatrix);var r=glMatrix.vec4.fromValues(0,0,0,1);glMatrix.vec4.transformMat4(r,r,e);var n=this.children.map((function(t){return t.getWorldCoordinates(e)}));return n.unshift(r),n}},{key:"draw",value:function(t,e,r,n,i,o,a){this.updateModelMatrix();var u=e.mat4.create();if(e.mat4.multiply(u,n,this.modelMatrix),this.drawMode&&this.positionBuffer&&this.normalBuffer&&this.indexBuffer){var s=e.mat4.clone(u);e.mat4.invert(s,s),e.mat4.transpose(s,s);var l=t.getUniformLocation(r,"modelMatrix"),f=t.getUniformLocation(r,"viewMatrix"),c=t.getUniformLocation(r,"projMatrix"),h=t.getUniformLocation(r,"normalMatrix");t.uniformMatrix4fv(l,!1,u),t.uniformMatrix4fv(f,!1,i),t.uniformMatrix4fv(c,!1,o),t.uniformMatrix4fv(h,!1,s);var v=t.getAttribLocation(r,"aVertexPosition");t.enableVertexAttribArray(v),t.bindBuffer(t.ARRAY_BUFFER,this.positionBuffer),t.vertexAttribPointer(v,3,t.FLOAT,!1,0,0);var d=t.getAttribLocation(r,"aVertexNormal");t.enableVertexAttribArray(d),t.bindBuffer(t.ARRAY_BUFFER,this.normalBuffer),t.vertexAttribPointer(d,3,t.FLOAT,!1,0,0);var p=t.getAttribLocation(r,"aTextureCoord");t.enableVertexAttribArray(p),t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer),t.vertexAttribPointer(p,2,t.FLOAT,!1,0,0),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this.texture),t.uniform1i(t.getUniformLocation(r,"uSampler"),0);var m=t.getUniformLocation(r,"affectedByLighting");t.uniform1i(m,this.affectedByLighting);var y=t.getUniformLocation(r,"ambientTopColor");t.uniform3fv(y,a.ambientLight.topColor);var g=t.getUniformLocation(r,"ambientBottomColor");t.uniform3fv(g,a.ambientLight.bottomColor);var b=t.getUniformLocation(r,"ambientLightStrength");t.uniform1f(b,a.ambientLight.strength);var w=t.getUniformLocation(r,"directionalLightColor");t.uniform3fv(w,a.directionalLight.color);var P=t.getUniformLocation(r,"directionalLightVector");t.uniform3fv(P,a.directionalLight.direction);var M=t.getUniformLocation(r,"directionalLightStrength");t.uniform1f(M,a.directionalLight.strength);var x=t.getUniformLocation(r,"pointLightColor");t.uniform3fv(x,a.pointLight.color);var B=t.getUniformLocation(r,"pointLightStrength");t.uniform1f(B,a.pointLight.strength);var A=t.getUniformLocation(r,"light1WorldPosition");t.uniform3fv(A,a.pointLight.position1);var T=t.getUniformLocation(r,"light2WorldPosition");t.uniform3fv(T,a.pointLight.position2);var E=t.getUniformLocation(r,"usesNormalMap");t.uniform1i(E,null!=this.normalMap),this.normalMap&&(t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,this.normalMap),t.uniform1i(t.getUniformLocation(r,"uSamplerNormal"),1)),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.drawElements(this.drawMode,this.indexBuffer.number_vertex_point,t.UNSIGNED_SHORT,0)}this.children.forEach((function(n){return n.draw(t,e,r,u,i,o,a)}))}}],e&&l(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function v(t,e,r,n,i){var o=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,o),t.bufferData(t.ARRAY_BUFFER,new Float32Array(e),t.STATIC_DRAW);var a=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,a),t.bufferData(t.ARRAY_BUFFER,new Float32Array(r),t.STATIC_DRAW);var u=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,u),t.bufferData(t.ARRAY_BUFFER,new Float32Array(n),t.STATIC_DRAW);var s=t.createBuffer();return s.number_vertex_point=i.length,t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,s),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(i),t.STATIC_DRAW),{glPositionBuffer:o,glNormalBuffer:a,glUVBuffer:u,glIndexBuffer:s}}function d(t){return function(t){if(Array.isArray(t))return m(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||p(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(t,e){if(t){if("string"==typeof t)return m(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?m(t,e):void 0}}function m(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function y(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))}function g(t,e,r,n,i,o){for(var a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,u=[],s=[],l=[],f=r.getArrays(),c=f.positionArray,h=f.normalArray,d=f.uvArray,m=function(t){for(var e=0,r=t[0],n=1;n<t.length;n++){var i=t[n];e+=y(r,i),r=i}return e}(c),g=0;g<n.length;g++){var w=e.mat4.create();e.mat4.invert(w,n[g]),e.mat4.transpose(w,w);for(var P=c[0],M=0,x=0;x<c.length;x++){var B=e.vec4.create(),A=e.vec4.create();e.vec4.transformMat4(B,c[x],n[g]),e.vec4.transformMat4(A,h[x],w),u.push(B[0],B[1],B[2]),s.push(A[0],A[1],A[2]);var T=(M+=y(P,c[x]))/m*a,E=g%2==0?1:0;l.push(T,E),P=c[x]}}var S,k,R,C,I=(R=b(c,d,n,i,o),C=2,function(t){if(Array.isArray(t))return t}(R)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,i,o,a,u=[],s=!0,l=!1;try{if(o=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;s=!1}else for(;!(s=(n=o.call(r)).done)&&(u.push(n.value),u.length!==e);s=!0);}catch(t){l=!0,i=t}finally{try{if(!s&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(l)throw i}}return u}}(R,C)||p(R,C)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}());S=I[0],k=I[1],i&&(u=S.positionBuffer.concat(u),s=S.normalBuffer.concat(s),l=S.uvBuffer.concat(l)),o&&(u=u.concat(k.positionBuffer),s=s.concat(k.normalBuffer),l=l.concat(k.uvBuffer));var V=function(t,e){for(var r=[],n=0;n<t-1;n++){r.push(n*e);for(var i=0;i<e-1;i++)r.push(n*e+i),r.push((n+1)*e+i),r.push(n*e+i+1),r.push((n+1)*e+i+1);r.push((n+1)*e+e-1)}return r}(n.length+2*i+2*o,c.length);return v(t,u,s,l,V)}function b(t,e,r,n,i){var o,a,u=(o=t,a=glMatrix.vec4.create(),o.forEach((function(t){return glMatrix.vec4.add(a,a,t)})),glMatrix.vec4.scale(a,a,1/o.length),a),s=[],l=[],f=[];if(n){var c=glMatrix.vec4.fromValues(0,0,-1,1);glMatrix.vec4.transformMat4(c,c,r[0]),glMatrix.vec4.normalize(c,c);var h=glMatrix.vec4.create();glMatrix.vec4.transformMat4(h,u,r[0]);for(var v=0;v<t.length;v++)s.push(h[0],h[1],h[2]),l.push(c[0],c[1],c[2]),f.push(.5,.5);t.forEach((function(t){var e=glMatrix.vec4.create();glMatrix.vec4.transformMat4(e,t,r[0]),s.push(e[0],e[1],e[2]),l.push(c[0],c[1],c[2])})),f.push.apply(f,d(e))}var p=[],m=[],y=[];if(i){var g=glMatrix.vec4.fromValues(0,0,1,1);glMatrix.vec4.transformMat4(g,g,r[r.length-1]),glMatrix.vec4.normalize(g,g),t.forEach((function(t){var e=glMatrix.vec4.create();glMatrix.vec4.transformMat4(e,t,r[r.length-1]),p.push(e[0],e[1],e[2]),m.push(g[0],g[1],g[2])})),y.push.apply(y,d(e));var b=glMatrix.vec4.create();glMatrix.vec4.transformMat4(b,u,r[r.length-1]);for(var w=0;w<t.length;w++)p.push(b[0],b[1],b[2]),m.push(g[0],g[1],g[2]),y.push(.5,.5)}return[{positionBuffer:s,normalBuffer:l,uvBuffer:f},{positionBuffer:p,normalBuffer:m,uvBuffer:y}]}var w=.2,P=.25,M=20;function x(t,e,r){var n=e.mat4.fromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),i=e.mat4.fromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,w,1),o=g(t,e,new u(P,M),[n,i],!0,!0);return new h(t.TRIANGLE_STRIP,o.glPositionBuffer,o.glNormalBuffer,o.glIndexBuffer,o.glUVBuffer,r)}function B(t){return B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},B(t)}function A(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,E(n.key),n)}}function T(t,e,r){return(e=E(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function E(t){var e=function(t,e){if("object"!=B(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=B(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==B(e)?e:e+""}var S=function(){return t=function t(e,r,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),T(this,"base",0),T(this,"top",0),T(this,"height",0),this.base=e,this.top=r,this.height=n},(e=[{key:"getArrays",value:function(){var t=[],e=[],r=[],n=this.base-this.top,i=n/this.base,o=glMatrix.mat4.create();glMatrix.mat4.identity(o),glMatrix.mat4.rotate(o,o,Math.PI/2-Math.PI/4-Math.atan(this.height/n),[0,0,1]);var a=glMatrix.vec4.fromValues(1,0,0,1);glMatrix.vec4.transformMat4(a,a,o);var u=glMatrix.vec4.fromValues(-a[0],a[1],0,1);return t.push(glMatrix.vec4.fromValues(-this.base/2,-this.height/2,0,1)),e.push(glMatrix.vec4.fromValues(0,-1,0,1)),r.push(0,0),t.push(glMatrix.vec4.fromValues(this.base/2,-this.height/2,0,1)),e.push(glMatrix.vec4.fromValues(0,-1,0,1)),r.push(1,0),t.push(glMatrix.vec4.fromValues(this.base/2,-this.height/2,0,1)),e.push(a),r.push(1,0),t.push(glMatrix.vec4.fromValues(this.top/2,this.height/2,0,1)),e.push(a),r.push(1-i,1),t.push(glMatrix.vec4.fromValues(this.top/2,this.height/2,0,1)),e.push(glMatrix.vec4.fromValues(0,1,0,1)),r.push(1-i,1),t.push(glMatrix.vec4.fromValues(-this.top/2,this.height/2,0,1)),e.push(glMatrix.vec4.fromValues(0,1,0,1)),r.push(i,1),t.push(glMatrix.vec4.fromValues(-this.top/2,this.height/2,0,1)),e.push(u),r.push(i,1),t.push(glMatrix.vec4.fromValues(-this.base/2,-this.height/2,0,1)),e.push(u),r.push(0,0),{positionArray:t,normalArray:e,uvArray:r}}}])&&A(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}(),k=3,R=2.5,C=.6,I=1,V=2,U=1.5,L=.5,j=.95,D=I/2.7,_=.2;function N(t,e,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"blue",i=new h,o=x(t,e,r.getTexture("black")),a=x(t,e,r.getTexture("black")),u=new h;o.translationVector=[0,0,-D-w],a.translationVector=[0,0,D],u.addChild(o),u.addChild(a),u.translationVector=[k/3,P,0],i.addChild(u);var s=x(t,e,r.getTexture("black")),l=x(t,e,r.getTexture("black")),f=new h;s.translationVector=[0,0,-D-w],l.translationVector=[0,0,D],f.addChild(s),f.addChild(l),f.translationVector=[-k/3,P,0],i.addChild(f);var c=function(t,e,r){var n=e.mat4.fromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),i=e.mat4.fromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,I,1),o=g(t,e,new S(k,R,C),[n,i],!0,!0),a=new h(t.TRIANGLE_STRIP,o.glPositionBuffer,o.glNormalBuffer,o.glIndexBuffer,o.glUVBuffer,r),u=e.mat4.fromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,j,1),s=g(t,e,new S(V,U,L),[n,u],!0,!0),l=new h(t.TRIANGLE_STRIP,s.glPositionBuffer,s.glNormalBuffer,s.glIndexBuffer,s.glUVBuffer,r);l.translationVector=[0,C/2+L/2,0];var f=new h;return f.addChild(a),f.addChild(l),f}(t,e,r.getTexture(n));return c.translationVector=[0,C/2+_,-I/2],i.addChild(c),i}function O(t,e){for(var r=[],n=0;n<e.length-1;n++)r.push(F(t,e[n],e[n+1]));return r.push(function(t,e,r){var n=Y(t,e,r),i=t.vec3.fromValues(0,1,0);return X(t,n,G(t,n),i,r)}(t,e[e.length-2],e[e.length-1])),r}function F(t,e,r){var n=Y(t,e,r),i=t.vec3.fromValues(0,1,0);return X(t,n,G(t,n),i,e)}function Y(t,e,r){var n=t.vec3.fromValues(r[0]-e[0],0,r[1]-e[1]);return t.vec3.normalize(n,n),n}function G(t,e){var r=t.vec3.create();return t.vec3.rotateY(r,e,[0,0,0],Math.PI/2),r}function X(t,e,r,n,i){return t.mat4.fromValues(r[0],r[1],r[2],0,n[0],n[1],n[2],0,e[0],e[1],e[2],0,i[0],0,i[1],1)}function W(t,e,r){return e.map((function(e){return function(t,e,r){var n=[e[12]+r*e[0],e[13]+r*e[1],e[14]+r*e[2]],i=t.mat4.create();return t.mat4.copy(i,e),i[12]=n[0],i[13]=n[1],i[14]=n[2],i}(t,e,r)}))}function z(t){return z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},z(t)}function K(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,q(n.key),n)}}function H(t,e,r){return(e=q(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function q(t){var e=function(t,e){if("object"!=z(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=z(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==z(e)?e:e+""}var $=function(){return t=function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),H(this,"width",void 0),H(this,"height",void 0),this.width=e,this.height=r},(e=[{key:"getArrays",value:function(){var t=[],e=[],r=[];return t.push(glMatrix.vec4.fromValues(-this.width/2,-this.height/2,0,1)),e.push(glMatrix.vec4.fromValues(0,-1,0,1)),r.push(0,0),t.push(glMatrix.vec4.fromValues(this.width/2,-this.height/2,0,1)),e.push(glMatrix.vec4.fromValues(0,-1,0,1)),r.push(1,0),t.push(glMatrix.vec4.fromValues(this.width/2,-this.height/2,0,1)),e.push(glMatrix.vec4.fromValues(1,0,0,1)),r.push(1,0),t.push(glMatrix.vec4.fromValues(this.width/2,this.height/2,0,1)),e.push(glMatrix.vec4.fromValues(1,0,0,1)),r.push(1,1),t.push(glMatrix.vec4.fromValues(this.width/2,this.height/2,0,1)),e.push(glMatrix.vec4.fromValues(0,1,0,1)),r.push(1,1),t.push(glMatrix.vec4.fromValues(-this.width/2,this.height/2,0,1)),e.push(glMatrix.vec4.fromValues(0,1,0,1)),r.push(0,1),t.push(glMatrix.vec4.fromValues(-this.width/2,this.height/2,0,1)),e.push(glMatrix.vec4.fromValues(-1,0,0,1)),r.push(0,1),t.push(glMatrix.vec4.fromValues(-this.width/2,-this.height/2,0,1)),e.push(glMatrix.vec4.fromValues(-1,0,0,1)),r.push(0,0),{positionArray:t,normalArray:e,uvArray:r}}}])&&K(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function Z(t){return Z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Z(t)}function J(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,tt(n.key),n)}}function Q(t,e,r){return(e=tt(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function tt(t){var e=function(t,e){if("object"!=Z(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=Z(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Z(e)?e:e+""}var et=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Q(this,"pointsByDistance",{}),Q(this,"totalDistance",0),this.pointsByDistance[0]=e[0];for(var r,n,i=0,o=1;o<e.length;o++)i+=(r=e[o],n=e[o-1],Math.sqrt(Math.pow(r[0]-n[0],2)+Math.pow(r[1]-n[1],2))),this.pointsByDistance[i]=e[o];this.totalDistance=i},(e=[{key:"getInterpolatedPoint",value:function(t){if(0===t)return this.pointsByDistance[0];var e=0;for(var r in this.pointsByDistance){if(t>=e&&t<=r){var n=this.pointsByDistance[e],i=this.pointsByDistance[r],o=(t-e)/(r-e);return[n[0]*(1-o)+i[0]*o,n[1]*(1-o)+i[1]*o]}e=r}alert("LUT: distance out of bounds")}},{key:"getClosestPointAndIndex",value:function(t){if(0===t)return[this.pointsByDistance[0],0];var e=0,r=-1;for(var n in this.pointsByDistance){if(t>=e&&t<=n)return[this.pointsByDistance[n],r];r+=1,e=n}alert("Distance out of bounds")}},{key:"getTotalDistance",value:function(){return this.totalDistance}}])&&J(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function rt(t){return rt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},rt(t)}function nt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,ot(n.key),n)}}function it(t,e,r){return(e=ot(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function ot(t){var e=function(t,e){if("object"!=rt(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=rt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==rt(e)?e:e+""}var at=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),it(this,"deltaU",20),it(this,"points",[])},(e=[{key:"setControlPoints",value:function(t){var e=this;if(!Array.isArray(t))throw"points no es un array";t.forEach((function(t){return e.points.push([t[0],t[1]])}))}},{key:"getPolygon",value:function(){for(var t=[],e=0;e<this.points.length-2;e++)for(var r=0;r<this.deltaU;r++)t.push(this.getPoint(e,r/this.deltaU));return t}},{key:"getPoint",value:function(t,e){var r=this.b0(e),n=this.b1(e),i=this.b2(e),o=t,a=t+1,u=t+2;return[r*this.points[o][0]+n*this.points[a][0]+i*this.points[u][0],r*this.points[o][1]+n*this.points[a][1]+i*this.points[u][1]]}},{key:"b0",value:function(t){return.5*(1-t)*(1-t)}},{key:"b1",value:function(t){return.5+t*(1-t)}},{key:"b2",value:function(t){return.5*t*t}}])&&nt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}(),ut=.2,st=20,lt=10,ft=1,ct=3,ht=2,vt=.3;function dt(t,e,r){var n=function(t,e,r){var n=new S(ct,ht,vt),i=e.mat4.fromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),o=e.mat4.fromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,ft,1),a=g(t,e,n,[i,o],!0,!0),u=new h(t.TRIANGLE_STRIP,a.glPositionBuffer,a.glNormalBuffer,a.glIndexBuffer,a.glUVBuffer,r);return u.translationVector=[lt,st-ut,-ft/2],u}(t,e,r),i=function(t,e,r){var n=new u(ut),i=new at;i.setControlPoints([[0,0],[0,0],[0,st-lt],[0,st-lt],[0,st],[lt,st],[lt,st]]);var o=g(t,e,n,O(e,i.getPolygon()),!1,!0),a=new h(t.TRIANGLE_STRIP,o.glPositionBuffer,o.glNormalBuffer,o.glIndexBuffer,o.glUVBuffer,r);return a.rotationAxis=[1,0,0],a.rotationDegree=-Math.PI/2,a}(t,e,r),o=new h;return o.addChild(n),o.addChild(i),o}function pt(t){return pt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},pt(t)}function mt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,gt(n.key),n)}}function yt(t,e,r){return(e=gt(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function gt(t){var e=function(t,e){if("object"!=pt(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=pt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==pt(e)?e:e+""}var bt=function(){return t=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),yt(this,"radius",void 0),yt(this,"definition",void 0),this.radius=e,this.definition=r},(e=[{key:"getPosition",value:function(t){var e=t*Math.PI/2,r=this.radius*Math.cos(e),n=this.radius*Math.sin(e);return glMatrix.vec4.fromValues(r,n,0,1)}},{key:"getArrays",value:function(){for(var t=1/this.definition,e=[],r=[],n=[],i=0;i<=this.definition;i++){var o=this.getPosition(i*t),a=glMatrix.vec4.create();glMatrix.vec4.normalize(a,o),e.push(o),r.push(a),n.push(o[0]/this.radius+this.radius,o[1]/this.radius+this.radius)}return{positionArray:e,normalArray:r,uvArray:n}}}])&&mt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function wt(t,e,r,n,i){var o=function(t,e,r,n){var i=e.mat4.fromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),o=e.mat4.fromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,n,1),a=g(t,e,new u(8,16),[i,o],!1,!1,2);return new h(t.TRIANGLE_STRIP,a.glPositionBuffer,a.glNormalBuffer,a.glIndexBuffer,a.glUVBuffer,r)}(t,e,r,i),a=function(t,e,r){var n=function(t,e,r,n,i,o){for(var a=2*Math.PI/20,u=[],s=0;s<21;s++){var l=s*a,f=e.vec3.create(),c=e.vec3.create();e.vec3.rotateY(f,[0,0,1],[0,0,0],l),e.vec3.rotateY(c,[1,0,0],[0,0,0],l);var h=e.mat4.fromValues(c[0],c[1],c[2],0,0,1,0,0,f[0],f[1],f[2],0,0,0,0,1);u.push(h)}return g(t,e,r,u,!0,!0)}(t,e,new bt(12));return new h(t.TRIANGLE_STRIP,n.glPositionBuffer,n.glNormalBuffer,n.glIndexBuffer,n.glUVBuffer,r)}(t,e,n);return a.rotationAxis=[1,0,0],a.rotationDegree=-Math.PI/2,a.translationVector=[0,0,i],o.addChild(a),o.rotationAxis=[1,0,0],o.rotationDegree=Math.PI/2,o}var Pt=48,Mt=6;function xt(t,e,r,n){var i=g(t,e,new S(1,.5,1),n,!0,!0),o=new h(t.TRIANGLE_STRIP,i.glPositionBuffer,i.glNormalBuffer,i.glIndexBuffer,i.glUVBuffer,r);return o.translationVector=[0,3.5,0],o}var Bt=6,At=6,Tt=20,Et=Bt*At;function St(t){return St="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},St(t)}function kt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Ct(n.key),n)}}function Rt(t,e,r){return(e=Ct(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Ct(t){var e=function(t,e){if("object"!=St(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=St(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==St(e)?e:e+""}var It=function(){return t=function t(e,r,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Rt(this,"side",void 0),Rt(this,"cornerRadius",void 0),Rt(this,"positionArray",[]),Rt(this,"normalArray",[]),Rt(this,"uvArray",[]),this.side=e,this.cornerRadius=r,this.addCornerVertices(e/2-r,-e/2+r,1.5*Math.PI,n),this.addCornerVertices(e/2-r,e/2-r,0,n),this.addCornerVertices(-e/2+r,e/2-r,Math.PI/2,n),this.addCornerVertices(-e/2+r,-e/2+r,Math.PI,n),this.positionArray.push(glMatrix.vec4.fromValues(e/2-r,-e/2,0,1)),this.normalArray.push(glMatrix.vec4.fromValues(0,-1,0,1)),this.uvArray.push(-2*(e/2-r)/this.side*n+1,-e/2*-2/this.side*n)},(e=[{key:"addCornerVertices",value:function(t,e,r,n){for(var i=0;i<=4;i++){var o=i/4*(Math.PI/2),a=Math.cos(r+o),u=Math.sin(r+o),s=t+this.cornerRadius*a,l=e+this.cornerRadius*u;this.positionArray.push(glMatrix.vec4.fromValues(s,l,0,1)),this.normalArray.push(glMatrix.vec4.fromValues(a,u,0,1)),this.uvArray.push(-2*s/this.side*n+1,-2*l/this.side*n)}}},{key:"getArrays",value:function(){return{positionArray:this.positionArray,normalArray:this.normalArray,uvArray:this.uvArray}}}])&&kt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}(),Vt=.2,Ut=100,Lt=10;function jt(t,e,r,n){var i=e.mat4.fromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),o=e.mat4.fromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,Vt,1),a=g(t,e,new It(Ut,Lt,10),[i,o],!1,!0);return new h(t.TRIANGLE_STRIP,a.glPositionBuffer,a.glNormalBuffer,a.glIndexBuffer,a.glUVBuffer,r)}function Dt(t){return function(t){if(Array.isArray(t))return _t(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return _t(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_t(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _t(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}var Nt=24,Ot=12,Ft=4;function Yt(){for(var t=[],e=0;e<Ot;e++)t.push(Math.floor(Math.random()*(Bt-1))*At+At);return t}function Gt(){for(var t=[],e=0;e<Ot;e++)t.push(Math.floor(Math.random()*Ft));return t}function Xt(t,e,r,n,i,o){if(o)return jt(t,e,r.getTexture("grass"));var a=function(t,e,r){var n=[[-40,-40],[-20,-40],[0,-40],[20,-40],[20,-20],[20,0],[20,20],[0,20],[-20,20],[-40,20],[-40,0],[-40,-20]].map((function(n,i){return function(t,e,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,u=[],s=[],l=[],f=[];u.push(n,i,o,n,i,o,n,i,o,n+Tt,i,o,n+Tt,i,o,n+Tt,i,o,n,i+Tt,o,n,i+Tt,o,n,i+Tt,o,n+Tt,i+Tt,o,n+Tt,i+Tt,o,n+Tt,i+Tt,o,n,i,o+e,n,i,o+e,n,i,o+e,n+Tt,i,o+e,n+Tt,i,o+e,n+Tt,i,o+e,n,i+Tt,o+e,n,i+Tt,o+e,n,i+Tt,o+e,n+Tt,i+Tt,o+e,n+Tt,i+Tt,o+e,n+Tt,i+Tt,o+e),s.push(0,0,-1,0,-1,0,-1,0,0,0,0,-1,0,-1,0,1,0,0,0,0,-1,0,1,0,-1,0,0,0,0,-1,0,1,0,1,0,0,0,0,1,0,-1,0,-1,0,0,0,0,1,0,-1,0,1,0,0,0,0,1,0,1,0,-1,0,0,0,0,1,0,1,0,1,0,0);var c=e/Et,h=.25*r,v=h+.25;return l.push(h,0,h,0,v,0,h,0,v,0,h,0,h,0,v,0,h,0,h,0,h,0,v,0,h,0,h,c,v,c,h,0,v,c,h,c,h,0,v,c,h,c,h,0,h,c,v,c),f.push(0,3,6,3,6,9,1,4,16,1,13,16,2,14,8,14,8,20,7,10,22,7,19,22,5,17,23,5,23,11,12,15,18,15,18,21),{positionBuffer:u,normalBuffer:s,uvBuffer:l,indexBuffer:f=f.map((function(t){return t+a}))}}(t,e[i],r[i],n[0],n[1],Vt,i*Nt)})),i={positionBuffer:[],normalBuffer:[],uvBuffer:[],indexBuffer:[]};return n.forEach((function(t){var e,r,n,o;(e=i.positionBuffer).push.apply(e,Dt(t.positionBuffer)),(r=i.normalBuffer).push.apply(r,Dt(t.normalBuffer)),(n=i.uvBuffer).push.apply(n,Dt(t.uvBuffer)),(o=i.indexBuffer).push.apply(o,Dt(t.indexBuffer))})),i}(t,n,i),u=v(t,a.positionBuffer,a.normalBuffer,a.uvBuffer,a.indexBuffer),s=new h(t.TRIANGLES,u.glPositionBuffer,u.glNormalBuffer,u.glIndexBuffer,u.glUVBuffer,r.getTexture("buildings")),l=jt(t,e,r.getTexture("sidewalk"),r.getTexture("sidewalkNormal"));return l.addChild(s),l}var Wt=7e3;var zt=5e3;function Kt(t){return Kt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Kt(t)}function Ht(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function qt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,$t(n.key),n)}}function $t(t){var e=function(t,e){if("object"!=Kt(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=Kt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Kt(e)?e:e+""}var Zt=function(){return t=function t(e,r){var n,i,o,a=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,o=!1,(i=$t(i="isVisible"))in n?Object.defineProperty(n,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[i]=o,this.container=document.getElementById(e),this.resolution=r,this.mode="agregar",this.nodeRadius=4,this.nodes=[],this.canvas=this.createCanvas(),this.container.appendChild(this.canvas),this.toolbar=this.createToolbar(),this.container.appendChild(this.toolbar),this.toolbar.addEventListener("click",(function(t){"BUTTON"===t.target.tagName&&t.target.dataset.hasOwnProperty("mode")&&(a.mode=t.target.dataset.mode)})),this.currentMovingNode=null,this.canvas.addEventListener("click",(function(t){var e=Math.floor(t.clientX-a.canvas.getBoundingClientRect().left),r=Math.floor(t.clientY-a.canvas.getBoundingClientRect().top);if("agregar"===a.mode)a.addNode(e,r),a.computeCurve();else if("eliminar"===a.mode){var n=a.findNodeAt(e,r);n&&a.removeNode(n),a.computeCurve()}})),this.canvas.addEventListener("mousedown",(function(t){var e=Math.floor(t.clientX-a.canvas.getBoundingClientRect().left),r=Math.floor(t.clientY-a.canvas.getBoundingClientRect().top);"mover"===a.mode&&(a.currentMovingNode=a.findNodeAt(e,r))})),window.addEventListener("mouseup",(function(){a.currentMovingNode=null,a.computeCurve()})),this.canvas.addEventListener("mousemove",(function(t){if(a.currentMovingNode){var e=Math.min(a.canvas.width-2*a.nodeRadius,Math.floor(t.offsetX-a.nodeRadius)),r=Math.min(a.canvas.height-2*a.nodeRadius,Math.floor(t.offsetY-a.nodeRadius));a.currentMovingNode.style.left=e+"px",a.currentMovingNode.style.top=r+"px"}}))},e=[{key:"computeCurve",value:function(){var t=this.canvas.getContext("2d"),e=this.canvas.getBoundingClientRect();if(t.clearRect(0,0,e.width,e.height),!(this.nodes.length<3)){var r=new at,n=this.getControlPoints(),i=[];n.forEach((function(t,e){for(var r=0==e||e==n.length-1?2:1,o=1;o<=r;o++)i.push(t)})),r.setControlPoints(i);var o=r.getPolygon();this.drawCurve(o)}}},{key:"getControlPoints",value:function(){var t=[];return this.nodes.forEach((function(e,r){e.getBoundingClientRect(),t.push([e.offsetLeft+e.offsetWidth/2,e.offsetTop+e.offsetHeight/2])})),t}},{key:"setControlPoints",value:function(t){var e=this;if(!Array.isArray(t))throw"points no es un array";t.forEach((function(t,r){e.addNode(t[0],t[1])})),this.computeCurve()}},{key:"drawCurve",value:function(t){var e=this.canvas.getContext("2d");e.resetTransform(),e.lineWidth=3,e.strokeStyle="#00CC00",e.beginPath(),e.moveTo(t[0][0],t[0][1]);for(var r=1;r<t.length;r++)e.lineTo(t[r][0],t[r][1]);e.stroke()}},{key:"createCanvas",value:function(){var t=document.createElement("canvas");return t.width=this.resolution.width,t.height=this.resolution.height,t}},{key:"createToolbar",value:function(){var t=document.createElement("div");t.className="toolbar";var e=document.createElement("button");e.textContent="Agregar",e.dataset.mode="agregar";var r=document.createElement("button");r.textContent="Mover",r.dataset.mode="mover";var n=document.createElement("button");n.textContent="Eliminar",n.dataset.mode="eliminar";var i=document.createElement("button");return i.textContent="Borrar",t.appendChild(e),t.appendChild(r),t.appendChild(n),t.appendChild(i),i.addEventListener("click",this.onClickInicializar.bind(this)),t}},{key:"onClickInicializar",value:function(t){var e=this;this.nodes.forEach((function(t,r){return e.container.removeChild(t)})),this.nodes=[],this.computeCurve()}},{key:"addNode",value:function(t,e){var r=document.createElement("div");r.className="node",r.style.width="".concat(2*this.nodeRadius,"px"),r.style.height="".concat(2*this.nodeRadius,"px"),r.style.backgroundColor="red",r.style.borderRadius="50%",r.style.position="absolute",r.style.left="".concat(t-this.nodeRadius,"px"),r.style.top="".concat(e-this.nodeRadius,"px"),r.style.pointerEvents="none",r.addEventListener,this.container.appendChild(r),this.nodes.push(r)}},{key:"removeNode",value:function(t){this.container.removeChild(t),this.nodes=this.nodes.filter((function(e){return e!==t}))}},{key:"findNodeAt",value:function(t,e){var r,n,i,o,a,u=null,s=20,l=function(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return Ht(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Ht(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){u=!0,o=t},f:function(){try{a||null==r.return||r.return()}finally{if(u)throw o}}}}(this.nodes);try{for(l.s();!(r=l.n()).done;){var f=r.value,c=parseFloat(f.style.left),h=parseFloat(f.style.top),v=(n=t,i=e,o=c+this.nodeRadius,a=h+this.nodeRadius,Math.sqrt(Math.pow(n-o,2)+Math.pow(i-a,2)));v<s&&(u=f,s=v)}}catch(t){l.e(t)}finally{l.f()}return u}},{key:"toggleVisibility",value:function(){this.container.style.visibility=this.isVisible?"visible":"hidden",this.isVisible=!this.isVisible}}],e&&qt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function Jt(t){return Jt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Jt(t)}function Qt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,ee(n.key),n)}}function te(t,e,r){return(e=ee(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function ee(t){var e=function(t,e){if("object"!=Jt(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=Jt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Jt(e)?e:e+""}var re=function(){return t=function t(e,r,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),te(this,"levelMatrices",void 0),te(this,"lookUpTable",void 0),te(this,"velocity",void 0),te(this,"currentDistanceTravelled",0),this.levelMatrices=W(e,r,i);var o=function(t){return t.map((function(t){return function(t){return t.slice(12,15)}(t)}))}(this.levelMatrices).map((function(t){return[t[0],t[2]]}));this.lookUpTable=new et(o),this.velocity=n},(e=[{key:"getNewPositionAndRotationAngle",value:function(t){var e=this.currentDistanceTravelled+this.velocity;e>this.lookUpTable.getTotalDistance()&&(e-=this.lookUpTable.getTotalDistance()),this.currentDistanceTravelled=e;var r=this.lookUpTable.getInterpolatedPoint(e),n=[r[0],3,r[1]],i=this.lookUpTable.getClosestPointAndIndex(e)[1],o=this.levelMatrices[i].slice(8,12);return{newPosition:n,angle:t.vec3.angle(o,[1,0,0])}}}])&&Qt(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function ne(t){return ne="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ne(t)}function ie(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,oe(n.key),n)}}function oe(t){var e=function(t,e){if("object"!=ne(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=ne(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ne(e)?e:e+""}var ae=[21,12,4,4,12,21],ue=[.5,.6,.7,.7,.6,.5],se=function(){return t=function t(e,r){var n,i,o;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,o=[],(i=oe(i="carAnimations"))in n?Object.defineProperty(n,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[i]=o;var a=function(t,e){return e.reverse().map((function(e){return function(t,e){var r=t.mat4.create();return t.mat4.copy(r,e),[0,1,2,8,9,10].forEach((function(t){return r[t]=-r[t]})),r}(t,e)}))}(e,r).reverse();this.carAnimations.push(new re(e,r,ue[0],ae[0])),this.carAnimations.push(new re(e,r,ue[1],ae[1])),this.carAnimations.push(new re(e,r,ue[2],ae[2])),this.carAnimations.push(new re(e,a,ue[3],ae[3])),this.carAnimations.push(new re(e,a,ue[4],ae[4])),this.carAnimations.push(new re(e,a,ue[5],ae[5]))},(e=[{key:"getCarsAnimationInfo",value:function(t){for(var e=this.carAnimations.map((function(e){return e.getNewPositionAndRotationAngle(t)})),r=0;r<3;r++)e[r].angle=-e[r].angle;return e}}])&&ie(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function le(t){return le="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},le(t)}function fe(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,ce(n.key),n)}}function ce(t){var e=function(t,e){if("object"!=le(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=le(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==le(e)?e:e+""}function he(t){return!(t&t-1)}function ve(t,e){var r=t.createTexture();t.bindTexture(t.TEXTURE_2D,r),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array([0,255,0,255]));var n=new Image;return n.onload=function(){t.bindTexture(t.TEXTURE_2D,r),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n),he(n.width)&&he(n.height)?(t.generateMipmap(t.TEXTURE_2D),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT)):(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR))},n.src=e,r}function de(t,e,r,n){var i=t.createTexture();return t.bindTexture(t.TEXTURE_2D,i),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array([e,r,n,255])),i}var pe=function(){return t=function t(e){var r,n,i;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),r=this,i={},(n=ce(n="map"))in r?Object.defineProperty(r,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[n]=i,this.map.buildings=ve(e,"./resources/buildings.jpg"),this.map.sidewalk=ve(e,"./resources/sidewalk2.jpg"),this.map.sidewalkNormal=ve(e,"./resources/sidewalk2_normal.jpg"),this.map.highwayRoad=ve(e,"./resources/highway_road_wide.jpg"),this.map.grass=ve(e,"./resources/grass2.jpg"),this.map.concrete=ve(e,"./resources/concrete.jpg"),this.map.concreteWall=ve(e,"./resources/concrete_wall.jpg"),this.map.skybox=ve(e,"./resources/skybox.png"),this.map.street=ve(e,"./resources/street.jpg"),this.map.grey=de(e,33,33,33),this.map.lightGrey=de(e,189,189,189),this.map.red=de(e,183,28,28),this.map.green=de(e,85,139,47),this.map.orange=de(e,230,81,0),this.map.blue=de(e,2,119,189),this.map.purple=de(e,69,39,160),this.map.black=de(e,0,0,0)},(e=[{key:"getTexture",value:function(t){return this.map[t]}}])&&fe(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function me(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,u=i?e:t,s=i?t:e,l=[0,1,2,3,4,5];return{positionBuffer:[r-u/2,n-s/2,0,r-u/2,n+s/2,0,r+u/2,n-s/2,0,r-u/2,n+s/2,0,r+u/2,n-s/2,0,r+u/2,n+s/2,0],normalBuffer:[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1],uvBuffer:i?[.5,0,0,0,.5,1*o,0,0,.5,1*o,0,1*o]:[0,0,0,1*o,.5,0,0,1*o,.5,0,.5,1*o],indexBuffer:l=l.map((function(t){return t+a}))}}function ye(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=[0,1,2,3,4,5];return{positionBuffer:[e-t/2,r-t/2,0,e-t/2,r+t/2,0,e+t/2,r-t/2,0,e-t/2,r+t/2,0,e+t/2,r-t/2,0,e+t/2,r+t/2,0],normalBuffer:[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1],uvBuffer:[.5,0,.5,1,1,0,.5,1,1,0,1,1],indexBuffer:i=i.map((function(t){return t+n}))}}function ge(t){return function(t){if(Array.isArray(t))return be(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return be(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?be(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function be(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}var we=10;function Pe(t){return Pe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Pe(t)}function Me(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,xe(n.key),n)}}function xe(t){var e=function(t,e){if("object"!=Pe(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=Pe(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Pe(e)?e:e+""}var Be=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.radius=500,this.alpha=Math.PI/2,this.beta=Math.PI/2,this.currentPosition={x:0,y:0},this.previousPosition={x:0,y:0},this.isMouseButtonPressed=!1,this.center=e.vec4.fromValues(0,0,0),this.up=e.vec4.fromValues(0,0,1),this.keysPressed={plus:!1,minus:!1}},e=[{key:"zoomIn",value:function(){this.radius=Math.max(100,this.radius-25)}},{key:"zoomOut",value:function(){this.radius=Math.min(1e3,this.radius+25)}},{key:"handleMouseMove",value:function(t){this.isMouseButtonPressed&&(this.currentPosition.x=t.clientX||t.pageX,this.currentPosition.y=t.clientY||t.pageY)}},{key:"handleMouseWheel",value:function(t){t.deltaY>0?this.zoomOut():t.deltaY<0&&this.zoomIn()}},{key:"handleMouseDown",value:function(t){0===t.button&&(this.previousPosition.x=t.clientX||t.pageX,this.previousPosition.y=t.clientY||t.pageY,this.currentPosition.x=this.previousPosition.x,this.currentPosition.y=this.previousPosition.y,this.isMouseButtonPressed=!0)}},{key:"handleMouseUp",value:function(t){0===t.button&&(this.isMouseButtonPressed=!1)}},{key:"handleKeyDown",value:function(t){"="===t.key?this.keysPressed.plus=!0:"-"===t.key&&(this.keysPressed.minus=!0)}},{key:"handleKeyUp",value:function(t){"="===t.key?this.keysPressed.plus=!1:"-"===t.key&&(this.keysPressed.minus=!1)}},{key:"getMatrix",value:function(t){var e=this.currentPosition.x-this.previousPosition.x,r=this.currentPosition.y-this.previousPosition.y;this.previousPosition.x=this.currentPosition.x,this.previousPosition.y=this.currentPosition.y,this.alpha=this.alpha-.005*e,this.beta=this.beta-.005*r,this.beta<.01&&(this.beta=.01),this.beta>Math.PI/2&&(this.beta=Math.PI/2);var n=t.vec4.fromValues(this.radius*Math.cos(this.alpha)*Math.sin(this.beta),this.radius*Math.sin(this.alpha)*Math.sin(this.beta),this.radius*Math.cos(this.beta)),i=t.mat4.create();return t.mat4.lookAt(i,n,this.center,this.up),i}},{key:"animate",value:function(t){return this.keysPressed.plus?this.zoomIn():this.keysPressed.minus&&this.zoomOut(),this.getMatrix(t)}}],e&&Me(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function Ae(t){return Ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ae(t)}function Te(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Se(n.key),n)}}function Ee(t,e,r){return(e=Se(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Se(t){var e=function(t,e){if("object"!=Ae(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=Ae(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Ae(e)?e:e+""}var ke=function(){return t=function t(e,r){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Ee(this,"playerPosition",void 0),Ee(this,"targetPosition",void 0),Ee(this,"alpha",0),Ee(this,"beta",0),Ee(this,"currentPosition",{x:0,y:0}),Ee(this,"previousPosition",{x:0,y:0}),Ee(this,"handleKeyUp",(function(t){"w"===t.key?n.keysPressed.w=!1:"s"===t.key?n.keysPressed.s=!1:"a"===t.key?n.keysPressed.a=!1:"d"===t.key&&(n.keysPressed.d=!1),t.shiftKey||(n.keysPressed.shift=!1)})),this.playerPosition=e.vec3.fromValues(r[0],r[1],r[2]+2),this.lookAround(e,0,0),this.isMouseButtonPressed=!1,this.keysPressed={w:!1,a:!1,s:!1,d:!1,shift:!1}},(e=[{key:"getMatrix",value:function(t){var e=this.currentPosition.x-this.previousPosition.x,r=this.currentPosition.y-this.previousPosition.y;this.previousPosition.x=this.currentPosition.x,this.previousPosition.y=this.currentPosition.y,this.lookAround(t,e,r);var n=t.mat4.create();return t.mat4.lookAt(n,this.playerPosition,this.targetPosition,[0,0,1]),n}},{key:"getPlayerForwardDirection",value:function(t){var e=t.vec3.fromValues(this.targetPosition[0]-this.playerPosition[0],this.targetPosition[1]-this.playerPosition[1],0);return t.vec3.normalize(e,e),e}},{key:"getPlayerRightDirection",value:function(t){var e=this.getPlayerForwardDirection(t),r=t.vec3.create();return t.vec3.rotateZ(r,e,[0,0,0],-Math.PI/2),r}},{key:"moveInDirection",value:function(t,e,r){var n=r?.7:.3;t.vec3.scale(e,e,n),t.vec3.add(this.playerPosition,this.playerPosition,e),t.vec3.add(this.targetPosition,this.targetPosition,e)}},{key:"moveForward",value:function(t,e){var r=this.getPlayerForwardDirection(t);this.moveInDirection(t,r,e)}},{key:"moveBackwards",value:function(t,e){var r=this.getPlayerForwardDirection(t),n=t.vec3.create();t.vec3.scale(n,r,-1),this.moveInDirection(t,n,e)}},{key:"moveRight",value:function(t,e){var r=this.getPlayerRightDirection(t);this.moveInDirection(t,r,e)}},{key:"moveLeft",value:function(t,e){var r=this.getPlayerRightDirection(t),n=t.vec3.create();t.vec3.scale(n,r,-1),this.moveInDirection(t,n,e)}},{key:"lookAround",value:function(t,e,r){this.alpha-=.01*e,this.beta-=.01*r,this.beta>Math.PI/2?this.beta=Math.PI/2:this.beta<-Math.PI/2+.01&&(this.beta=-Math.PI/2+.01);var n=t.vec3.fromValues(0,10,0);t.vec3.rotateX(n,n,[0,0,0],this.beta),t.vec3.rotateZ(n,n,[0,0,0],this.alpha),t.vec3.add(n,n,this.playerPosition),this.targetPosition=n}},{key:"handleMouseMove",value:function(t){this.isMouseButtonPressed&&(this.currentPosition.x=t.clientX||t.pageX,this.currentPosition.y=t.clientY||t.pageY)}},{key:"handleMouseDown",value:function(t){0===t.button&&(this.isMouseButtonPressed=!0,this.previousPosition.x=t.clientX||t.pageX,this.previousPosition.y=t.clientY||t.pageY,this.currentPosition.x=this.previousPosition.x,this.currentPosition.y=this.previousPosition.y)}},{key:"handleMouseUp",value:function(t){0===t.button&&(this.isMouseButtonPressed=!1)}},{key:"handleKeyDown",value:function(t){"w"===t.key?this.keysPressed.w=!0:"s"===t.key?this.keysPressed.s=!0:"a"===t.key?this.keysPressed.a=!0:"d"===t.key&&(this.keysPressed.d=!0),t.shiftKey&&(this.keysPressed.shift=!0)}},{key:"handleMouseWheel",value:function(){}},{key:"animate",value:function(t){var e=this.keysPressed.shift;return this.keysPressed.w&&this.moveForward(t,e),this.keysPressed.a&&this.moveLeft(t,e),this.keysPressed.s&&this.moveBackwards(t,e),this.keysPressed.d&&this.moveRight(t,e),this.getMatrix(t)}}])&&Te(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function Re(t){return Re="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Re(t)}function Ce(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Ve(n.key),n)}}function Ie(t,e,r){return(e=Ve(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Ve(t){var e=function(t,e){if("object"!=Re(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=Re(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Re(e)?e:e+""}var Ue=function(){return t=function t(){var e=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Ie(this,"handleMouseDown",(function(t){e.selectedCamera.handleMouseDown(t)})),Ie(this,"handleMouseUp",(function(t){e.selectedCamera.handleMouseUp(t)})),Ie(this,"handleKeyDown",(function(t){"1"===t.key?e.selectedCamera=e.orbitalCamera:"2"===t.key?e.cameraMode=e.streetCamera:"3"===t.key?e.cameraMode=e.highwayCamera:e.selectedCamera.handleKeyDown(t)})),Ie(this,"handleKeyUp",(function(t){e.selectedCamera.handleKeyUp(t)})),Ie(this,"handleMouseWheel",(function(t){e.selectedCamera.handleMouseWheel(t)})),Ie(this,"handleMouseMove",(function(t){e.selectedCamera.handleMouseMove(t)})),this.orbitalCamera=new Be,this.streetCamera=new ke([0,0,0]),this.highwayCamera=new ke([0,0,32]),this.selectedCamera=this.orbitalCamera;var r=document.getElementById("my-canvas");window.addEventListener("keydown",this.handleKeyDown.bind(this)),window.addEventListener("keyup",this.handleKeyUp.bind(this)),r.addEventListener("wheel",this.handleMouseWheel.bind(this)),r.addEventListener("mousedown",this.handleMouseDown.bind(this)),r.addEventListener("mouseup",this.handleMouseUp.bind(this)),window.addEventListener("mousemove",this.handleMouseMove.bind(this))},(e=[{key:"animate",value:function(){return this.selectedCamera.animate()}}])&&Ce(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function Le(t,e,r){var n=t.createShader(r);return t.shaderSource(n,e),t.compileShader(n),t.getShaderParameter(n,t.COMPILE_STATUS)||console.log("Error compiling shader: "+t.getShaderInfoLog(n)),n}var je=300,De=new Zt("editor-container",{width:je,height:je});De.setControlPoints([[0,0],[300,50],[50,300],[300,300]]);var _e=null,Ne=null,Oe=e(),Fe=e(),Ye=e(),Ge=document.getElementById("my-canvas");function Xe(t){requestAnimationFrame(Xe),function(){(function(t,e,r,n,i,o){var a=function(t,e){var r=-500,n=500,i=[r,r,0,r,n,0,n,n,0,n,r,0,0,r,0,0,n,0,r,0,0,n,0,0];return v(t,i,Array(i.length/3).fill([0,0,1]).flat(),[],[0,1,2,3,0,4,5,1,6,7])}(t),u=e.mat4.create();e.mat4.invert(u,i),e.mat4.transpose(u,u);var s=t.getUniformLocation(r,"modelMatrix"),l=t.getUniformLocation(r,"viewMatrix"),f=t.getUniformLocation(r,"projMatrix"),c=t.getUniformLocation(r,"normalMatrix");t.uniformMatrix4fv(s,!1,n),t.uniformMatrix4fv(l,!1,i),t.uniformMatrix4fv(f,!1,o),t.uniformMatrix4fv(c,!1,u);var h=t.getAttribLocation(r,"aVertexPosition");t.enableVertexAttribArray(h),t.bindBuffer(t.ARRAY_BUFFER,a.glPositionBuffer),t.vertexAttribPointer(h,3,t.FLOAT,!1,0,0);var d=t.getAttribLocation(r,"aVertexNormal");t.enableVertexAttribArray(d),t.bindBuffer(t.ARRAY_BUFFER,a.glNormalBuffer),t.vertexAttribPointer(d,3,t.FLOAT,!1,0,0),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,a.glIndexBuffer),t.drawElements(t.LINE_STRIP,a.glIndexBuffer.number_vertex_point,t.UNSIGNED_SHORT,0)})(_e,glMatrix,Ne,Oe,Fe,Ye),function(t,e,r,n,i,o){for(var a=new h,u=0;u<5;u++)for(var s=0;s<5;s++){var l=Xt(t,e,r,n[u+5*s],i[u+5*s],o[u+5*s]);l.translationVector=[(Ut+10)*(s-2),(Ut+10)*(u-2),0],a.addChild(l)}return a}(_e,glMatrix,nr,Ke,He,$e).draw(_e,glMatrix,Ne,Oe,Fe,Ye,er),function(t,e){var r=[],n=[],i=[],o=[];r.push(0,0,0,0,0,0,0,0,0,zt,0,0,zt,0,0,zt,0,0,0,zt,0,0,zt,0,0,zt,0,zt,zt,0,zt,zt,0,zt,zt,0,0,0,zt,0,0,zt,0,0,zt,zt,0,zt,zt,0,zt,zt,0,zt,0,zt,zt,0,zt,zt,0,zt,zt,zt,zt,zt,zt,zt,zt,zt,zt,zt),n.push(0,0,-1,0,-1,0,-1,0,0,0,0,-1,0,-1,0,1,0,0,0,0,-1,0,1,0,-1,0,0,0,0,-1,0,1,0,1,0,0,0,0,1,0,-1,0,-1,0,0,0,0,1,0,-1,0,1,0,0,0,0,1,0,1,0,-1,0,0,0,0,1,0,1,0,1,0,0),i.push(.25,1/3,.25,1/3,.25,1/3,.25,0,0,1/3,1,1/3,.5,1/3,.5,1/3,.5,1/3,.5,0,.75,1/3,.75,1/3,.25,2/3,.25,2/3,.25,2/3,.25,1,0,2/3,1,2/3,.5,2/3,.5,2/3,.5,2/3,.5,1,.75,2/3,.75,2/3),o.push(0,3,6,3,6,9,1,4,16,1,13,16,2,14,8,14,8,20,7,10,22,7,19,22,5,17,23,5,23,11,12,15,18,15,18,21);var a=v(t,r,n,i,o),u=new h,s=new h(t.TRIANGLES,a.glPositionBuffer,a.glNormalBuffer,a.glIndexBuffer,a.glUVBuffer,e.getTexture("skybox"),!1);return u.addChild(s),s.translationVector=[-2500,-2500,-2500],u.rotationAxis=[1,0,0],u.rotationDegree=Math.PI,u}(_e,nr).draw(_e,glMatrix,Ne,Oe,Fe,Ye,er);for(var t=Qe.getCarsAnimationInfo(glMatrix),e=[],r=0;r<6;r++)e.push(N(_e,glMatrix,nr,tr[r])),e[r].scalingVector=[2,2,2],e[r].translationVector=t[r].newPosition,e[r].rotationAxis=[0,1,0],e[r].rotationDegree=t[r].angle;var n=function(t,e,r,n,i,o){var a=O(e,n),u=function(t,e,r,n){var i=g(t,e,new $(Pt,Mt),n,!0,!0,1);return new h(t.TRIANGLE_STRIP,i.glPositionBuffer,i.glNormalBuffer,i.glIndexBuffer,i.glUVBuffer,r)}(t,e,r.getTexture("highwayRoad"),a),s=xt(t,e,r.getTexture("concrete"),a);u.addChild(s);var l=W(e,a,Pt/2),f=xt(t,e,r.getTexture("concrete"),l);u.addChild(f);var c=W(e,a,-Pt/2),v=xt(t,e,r.getTexture("concrete"),c);u.addChild(v);var d=function(t,e,r,n,i){for(var o=n.map((function(t){return[t[12],t[14]]})),a=new et(o),u=a.getTotalDistance()/(i-1),s=[],l=0;l<i;l++){var f=dt(t,e,r),c=a.getInterpolatedPoint(u*l),h=n[a.getClosestPointAndIndex(u*l)[1]],v=[h[0],h[1],h[2]],d=l%2==0;f.rotationAxis=[0,1,0],f.rotationDegree=e.vec3.angle(v,[0,0,1])+Math.PI/2+d*Math.PI,f.translationVector=[c[0],2,c[1]],s.push(f)}return s}(t,e,r.getTexture("lightGrey"),a,i);d.forEach((function(t){return u.addChild(t)}));var p=function(t,e,r,n,i,o){for(var a=new et(i),u=a.getTotalDistance()/(o-1),s=[],l=0;l<o;l++){var f=wt(t,e,r,n,30),c=a.getInterpolatedPoint(u*l);f.translationVector=[c[0],0,c[1]],s.push(f)}return s}(t,e,r.getTexture("concrete"),r.getTexture("concreteWall"),n,o);return p.forEach((function(t){return u.addChild(t)})),u}(_e,glMatrix,nr,qe,Ze,Je);n.rotationAxis=[1,0,0],n.rotationDegree=Math.PI/2,n.translationVector=[0,0,30];for(var i=0;i<6;i++)n.addChild(e[i]);n.draw(_e,glMatrix,Ne,Oe,Fe,Ye,er),function(t,e){var r,n,i,o,a=[],u=[],s=[],l=[],f=function(){for(var t={positionBuffer:[],normalBuffer:[],uvBuffer:[],indexBuffer:[],indexBufferOffset:0},e=0;e<4;e++)for(var r=0;r<5;r++){var n,i,o,a,u,s,l,f,c=110*e-165,h=110*r-220,v=me(we,Ut-2*Lt,c,h,!1,8,t.indexBufferOffset);(n=t.positionBuffer).push.apply(n,ge(v.positionBuffer)),(i=t.normalBuffer).push.apply(i,ge(v.normalBuffer)),(o=t.uvBuffer).push.apply(o,ge(v.uvBuffer)),(a=t.indexBuffer).push.apply(a,ge(v.indexBuffer)),t.indexBufferOffset+=6;var d=me(we,Ut-2*Lt,h,c,!0,8,t.indexBufferOffset);(u=t.positionBuffer).push.apply(u,ge(d.positionBuffer)),(s=t.normalBuffer).push.apply(s,ge(d.normalBuffer)),(l=t.uvBuffer).push.apply(l,ge(d.uvBuffer)),(f=t.indexBuffer).push.apply(f,ge(d.indexBuffer)),t.indexBufferOffset+=6}return t}(),c=function(t){for(var e={positionBuffer:[],normalBuffer:[],uvBuffer:[],indexBuffer:[]},r=0;r<4;r++)for(var n=0;n<4;n++){var i,o,a,u,s=ye(2*Lt+we,110*r-165,110*n-165,t);(i=e.positionBuffer).push.apply(i,ge(s.positionBuffer)),(o=e.normalBuffer).push.apply(o,ge(s.normalBuffer)),(a=e.uvBuffer).push.apply(a,ge(s.uvBuffer)),(u=e.indexBuffer).push.apply(u,ge(s.indexBuffer)),t+=6}return e}(f.indexBufferOffset);(r=a).push.apply(r,ge(f.positionBuffer).concat(ge(c.positionBuffer))),(n=u).push.apply(n,ge(f.normalBuffer).concat(ge(c.normalBuffer))),(i=s).push.apply(i,ge(f.uvBuffer).concat(ge(c.uvBuffer))),(o=l).push.apply(o,ge(f.indexBuffer).concat(ge(c.indexBuffer)));var d=v(t,a,u,s,l);return new h(t.TRIANGLES,d.glPositionBuffer,d.glNormalBuffer,d.glIndexBuffer,d.glUVBuffer,e.getTexture("street"))}(_e,nr).draw(_e,glMatrix,Ne,Oe,Fe,Ye,er);var o=N(_e,glMatrix,nr);o.rotationAxis=[1,0,0],o.rotationDegree=Math.PI/2,o.translationVector=[0,0,2],o.draw(_e,glMatrix,Ne,Oe,Fe,Ye,er)}(),Fe=ze.animate(glMatrix)}Ge.width=window.innerWidth,Ge.height=window.innerHeight,window.addEventListener("resize",(function(){Ge.width=window.innerWidth,Ge.height=window.innerHeight,_e.viewport(0,0,Ge.width,Ge.height),r(Ye,45,Ge.width/Ge.height,.1,null)}));var We={generate:function(){rr()},showEditor:function(){},lights:15,columns:10},ze=new Ue;window.addEventListener("keydown",(function(t){"h"===t.key&&De.toggleVisibility()}));var Ke=[],He=[],qe=[],$e=[],Ze=We.lights,Je=We.columns,Qe=null,tr=["red","grey","green","orange","blue","purple"],er={ambientLight:{topColor:[115,146,235],bottomColor:[216,197,150],strength:.5},directionalLight:{color:[252,255,181],direction:[1,2,3],strength:1.5},pointLight:{position1:null,position2:null,color:[255,230,146],strength:1}};function rr(){Ke=function(){for(var t=[],e=0;e<25;e++)t.push(Yt());return t}(),He=function(){for(var t=[],e=0;e<25;e++)t.push(Gt());return t}();var t=De.getControlPoints();t.unshift(t[0]),t.push(t[t.length-1]),t=t.map((function(t){return[(t[0]-150)*(560/300),(t[1]-150)*(560/300)]}));var e,r,n,i=new at;i.setControlPoints(t),qe=i.getPolygon(),e=qe,r=[[-220,220],[-220,110],[-220,0],[-220,-110],[-220,-220],[-110,220],[-110,110],[-110,0],[-110,-110],[-110,-220],[0,220],[0,110],[0,0],[0,-110],[0,-220],[110,220],[110,110],[110,0],[110,-110],[110,-220],[220,220],[220,110],[220,0],[220,-110],[220,-220]],n=Array(25).fill(!1),e.map((function(t){var e=r.map((function(e){return r=e,n=t,Math.pow(r[0]-n[0],2)+Math.pow(r[1]-n[1],2);var r,n})).map((function(t){return t<Wt}));n=n.map((function(t,r){return t||e[r]}))})),$e=n,Ze=Math.floor(We.lights),Je=Math.floor(We.columns),er.pointLight.position1=[qe[0][0],-qe[0][1],50],er.pointLight.position2=[qe[qe.length-1][0],-qe[qe.length-1][0],50];var o=O(glMatrix,qe);Qe=new se(glMatrix,o)}var nr=null;!function(){var t=new dat.GUI,e=t.addFolder("Generate");e.add(We,"generate").name("Generate Scenery"),e.open();var r=t.addFolder("Parameters");r.add(We,"lights",4,25).name("Lights"),r.add(We,"columns",4,25).name("Columns"),r.open()}(),window.onload=function(){try{_e=Ge.getContext("webgl")}catch(t){alert("Error: Your browser does not appear to support WebGL.")}var t;_e?(_e.enable(_e.DEPTH_TEST),_e.clearColor(.1,.1,.2,1),_e.clear(_e.COLOR_BUFFER_BIT|_e.DEPTH_BUFFER_BIT),_e.viewport(0,0,Ge.width,Ge.height),r(Ye,45,Ge.width/Ge.height,.1,null),(t=Oe)[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,Ne=function(t){var e=document.getElementById("shader-fs").innerHTML,r=Le(t,document.getElementById("shader-vs").innerHTML,t.VERTEX_SHADER),n=Le(t,e,t.FRAGMENT_SHADER),i=t.createProgram();return t.attachShader(i,r),t.attachShader(i,n),t.linkProgram(i),t.getProgramParameter(i,t.LINK_STATUS)||(alert("Unable to initialize the shader program."),console.log(t.getShaderInfoLog(r)),console.log(t.getShaderInfoLog(n))),t.useProgram(i),i}(_e),rr(),nr=new pe(_e),Xe()):alert("Error: Your browser does not appear to support WebGL.")}})();