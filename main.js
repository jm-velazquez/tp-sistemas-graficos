(()=>{"use strict";var t=1e-6,e="undefined"!=typeof Float32Array?Float32Array:Array;function n(){var t=new e(16);return e!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function i(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function o(t,n,i,o,r,s,a,l,u,d,h,c,f,p,_,g){var m=new e(16);return m[0]=t,m[1]=n,m[2]=i,m[3]=o,m[4]=r,m[5]=s,m[6]=a,m[7]=l,m[8]=u,m[9]=d,m[10]=h,m[11]=c,m[12]=f,m[13]=p,m[14]=_,m[15]=g,m}function r(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function s(t,e){if(t===e){var n=e[1],i=e[2],o=e[3],r=e[6],s=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=r,t[11]=e[14],t[12]=o,t[13]=s,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function a(t,e){var n=e[0],i=e[1],o=e[2],r=e[3],s=e[4],a=e[5],l=e[6],u=e[7],d=e[8],h=e[9],c=e[10],f=e[11],p=e[12],_=e[13],g=e[14],m=e[15],b=n*a-i*s,v=n*l-o*s,y=n*u-r*s,w=i*l-o*a,x=i*u-r*a,E=o*u-r*l,A=d*_-h*p,C=d*g-c*p,B=d*m-f*p,k=h*g-c*_,P=h*m-f*_,T=c*m-f*g,M=b*T-v*P+y*k+w*B-x*C+E*A;return M?(M=1/M,t[0]=(a*T-l*P+u*k)*M,t[1]=(o*P-i*T-r*k)*M,t[2]=(_*E-g*x+m*w)*M,t[3]=(c*x-h*E-f*w)*M,t[4]=(l*B-s*T-u*C)*M,t[5]=(n*T-o*B+r*C)*M,t[6]=(g*y-p*E-m*v)*M,t[7]=(d*E-c*y+f*v)*M,t[8]=(s*P-a*B+u*A)*M,t[9]=(i*B-n*P-r*A)*M,t[10]=(p*x-_*y+m*b)*M,t[11]=(h*y-d*x-f*b)*M,t[12]=(a*C-s*k-l*A)*M,t[13]=(n*k-i*C+o*A)*M,t[14]=(_*v-p*w-g*b)*M,t[15]=(d*w-h*v+c*b)*M,t):null}function l(e,n,i,o){var r,s,a,l,u,d,h,c,f,p,_,g,m,b,v,y,w,x,E,A,C,B,k,P,T=o[0],M=o[1],R=o[2],S=Math.hypot(T,M,R);return S<t?null:(T*=S=1/S,M*=S,R*=S,r=Math.sin(i),a=1-(s=Math.cos(i)),l=n[0],u=n[1],d=n[2],h=n[3],c=n[4],f=n[5],p=n[6],_=n[7],g=n[8],m=n[9],b=n[10],v=n[11],y=T*T*a+s,w=M*T*a+R*r,x=R*T*a-M*r,E=T*M*a-R*r,A=M*M*a+s,C=R*M*a+T*r,B=T*R*a+M*r,k=M*R*a-T*r,P=R*R*a+s,e[0]=l*y+c*w+g*x,e[1]=u*y+f*w+m*x,e[2]=d*y+p*w+b*x,e[3]=h*y+_*w+v*x,e[4]=l*E+c*A+g*C,e[5]=u*E+f*A+m*C,e[6]=d*E+p*A+b*C,e[7]=h*E+_*A+v*C,e[8]=l*B+c*k+g*P,e[9]=u*B+f*k+m*P,e[10]=d*B+p*k+b*P,e[11]=h*B+_*k+v*P,n!==e&&(e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15]),e)}Math.random,Math.PI,Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var u=function(t,e,n,i,o){var r,s=1/Math.tan(e/2);return t[0]=s/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=o&&o!==1/0?(r=1/(i-o),t[10]=(o+i)*r,t[14]=2*o*i*r):(t[10]=-1,t[14]=-2*i),t};function d(e,n,i,o){var s,a,l,u,d,h,c,f,p,_,g=n[0],m=n[1],b=n[2],v=o[0],y=o[1],w=o[2],x=i[0],E=i[1],A=i[2];return Math.abs(g-x)<t&&Math.abs(m-E)<t&&Math.abs(b-A)<t?r(e):(c=g-x,f=m-E,p=b-A,s=y*(p*=_=1/Math.hypot(c,f,p))-w*(f*=_),a=w*(c*=_)-v*p,l=v*f-y*c,(_=Math.hypot(s,a,l))?(s*=_=1/_,a*=_,l*=_):(s=0,a=0,l=0),u=f*l-p*a,d=p*s-c*l,h=c*a-f*s,(_=Math.hypot(u,d,h))?(u*=_=1/_,d*=_,h*=_):(u=0,d=0,h=0),e[0]=s,e[1]=u,e[2]=c,e[3]=0,e[4]=a,e[5]=d,e[6]=f,e[7]=0,e[8]=l,e[9]=h,e[10]=p,e[11]=0,e[12]=-(s*g+a*m+l*b),e[13]=-(u*g+d*m+h*b),e[14]=-(c*g+f*m+p*b),e[15]=1,e)}function h(t,e){var n=t.__state.conversionName.toString(),i=Math.round(t.r),o=Math.round(t.g),r=Math.round(t.b),s=t.a,a=Math.round(t.h),l=t.s.toFixed(1),u=t.v.toFixed(1);if(e||"THREE_CHAR_HEX"===n||"SIX_CHAR_HEX"===n){for(var d=t.hex.toString(16);d.length<6;)d="0"+d;return"#"+d}return"CSS_RGB"===n?"rgb("+i+","+o+","+r+")":"CSS_RGBA"===n?"rgba("+i+","+o+","+r+","+s+")":"HEX"===n?"0x"+t.hex.toString(16):"RGB_ARRAY"===n?"["+i+","+o+","+r+"]":"RGBA_ARRAY"===n?"["+i+","+o+","+r+","+s+"]":"RGB_OBJ"===n?"{r:"+i+",g:"+o+",b:"+r+"}":"RGBA_OBJ"===n?"{r:"+i+",g:"+o+",b:"+r+",a:"+s+"}":"HSV_OBJ"===n?"{h:"+a+",s:"+l+",v:"+u+"}":"HSVA_OBJ"===n?"{h:"+a+",s:"+l+",v:"+u+",a:"+s+"}":"unknown format"}var c=Array.prototype.forEach,f=Array.prototype.slice,p={BREAK:{},extend:function(t){return this.each(f.call(arguments,1),(function(e){(this.isObject(e)?Object.keys(e):[]).forEach(function(n){this.isUndefined(e[n])||(t[n]=e[n])}.bind(this))}),this),t},defaults:function(t){return this.each(f.call(arguments,1),(function(e){(this.isObject(e)?Object.keys(e):[]).forEach(function(n){this.isUndefined(t[n])&&(t[n]=e[n])}.bind(this))}),this),t},compose:function(){var t=f.call(arguments);return function(){for(var e=f.call(arguments),n=t.length-1;n>=0;n--)e=[t[n].apply(this,e)];return e[0]}},each:function(t,e,n){if(t)if(c&&t.forEach&&t.forEach===c)t.forEach(e,n);else if(t.length===t.length+0){var i,o=void 0;for(o=0,i=t.length;o<i;o++)if(o in t&&e.call(n,t[o],o)===this.BREAK)return}else for(var r in t)if(e.call(n,t[r],r)===this.BREAK)return},defer:function(t){setTimeout(t,0)},debounce:function(t,e,n){var i=void 0;return function(){var o=this,r=arguments,s=n||!i;clearTimeout(i),i=setTimeout((function(){i=null,n||t.apply(o,r)}),e),s&&t.apply(o,r)}},toArray:function(t){return t.toArray?t.toArray():f.call(t)},isUndefined:function(t){return void 0===t},isNull:function(t){return null===t},isNaN:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(t){return isNaN(t)})),isArray:Array.isArray||function(t){return t.constructor===Array},isObject:function(t){return t===Object(t)},isNumber:function(t){return t===t+0},isString:function(t){return t===t+""},isBoolean:function(t){return!1===t||!0===t},isFunction:function(t){return t instanceof Function}},_=[{litmus:p.isString,conversions:{THREE_CHAR_HEX:{read:function(t){var e=t.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString()+e[1].toString()+e[2].toString()+e[2].toString()+e[3].toString()+e[3].toString(),0)}},write:h},SIX_CHAR_HEX:{read:function(t){var e=t.match(/^#([A-F0-9]{6})$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString(),0)}},write:h},CSS_RGB:{read:function(t){var e=t.match(/^rgb\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3])}},write:h},CSS_RGBA:{read:function(t){var e=t.match(/^rgba\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3]),a:parseFloat(e[4])}},write:h}}},{litmus:p.isNumber,conversions:{HEX:{read:function(t){return{space:"HEX",hex:t,conversionName:"HEX"}},write:function(t){return t.hex}}}},{litmus:p.isArray,conversions:{RGB_ARRAY:{read:function(t){return 3===t.length&&{space:"RGB",r:t[0],g:t[1],b:t[2]}},write:function(t){return[t.r,t.g,t.b]}},RGBA_ARRAY:{read:function(t){return 4===t.length&&{space:"RGB",r:t[0],g:t[1],b:t[2],a:t[3]}},write:function(t){return[t.r,t.g,t.b,t.a]}}}},{litmus:p.isObject,conversions:{RGBA_OBJ:{read:function(t){return!!(p.isNumber(t.r)&&p.isNumber(t.g)&&p.isNumber(t.b)&&p.isNumber(t.a))&&{space:"RGB",r:t.r,g:t.g,b:t.b,a:t.a}},write:function(t){return{r:t.r,g:t.g,b:t.b,a:t.a}}},RGB_OBJ:{read:function(t){return!!(p.isNumber(t.r)&&p.isNumber(t.g)&&p.isNumber(t.b))&&{space:"RGB",r:t.r,g:t.g,b:t.b}},write:function(t){return{r:t.r,g:t.g,b:t.b}}},HSVA_OBJ:{read:function(t){return!!(p.isNumber(t.h)&&p.isNumber(t.s)&&p.isNumber(t.v)&&p.isNumber(t.a))&&{space:"HSV",h:t.h,s:t.s,v:t.v,a:t.a}},write:function(t){return{h:t.h,s:t.s,v:t.v,a:t.a}}},HSV_OBJ:{read:function(t){return!!(p.isNumber(t.h)&&p.isNumber(t.s)&&p.isNumber(t.v))&&{space:"HSV",h:t.h,s:t.s,v:t.v}},write:function(t){return{h:t.h,s:t.s,v:t.v}}}}}],g=void 0,m=void 0,b=function(){m=!1;var t=arguments.length>1?p.toArray(arguments):arguments[0];return p.each(_,(function(e){if(e.litmus(t))return p.each(e.conversions,(function(e,n){if(g=e.read(t),!1===m&&!1!==g)return m=g,g.conversionName=n,g.conversion=e,p.BREAK})),p.BREAK})),m},v=void 0,y={hsv_to_rgb:function(t,e,n){var i=Math.floor(t/60)%6,o=t/60-Math.floor(t/60),r=n*(1-e),s=n*(1-o*e),a=n*(1-(1-o)*e),l=[[n,a,r],[s,n,r],[r,n,a],[r,s,n],[a,r,n],[n,r,s]][i];return{r:255*l[0],g:255*l[1],b:255*l[2]}},rgb_to_hsv:function(t,e,n){var i=Math.min(t,e,n),o=Math.max(t,e,n),r=o-i,s=void 0;return 0===o?{h:NaN,s:0,v:0}:(s=t===o?(e-n)/r:e===o?2+(n-t)/r:4+(t-e)/r,(s/=6)<0&&(s+=1),{h:360*s,s:r/o,v:o/255})},rgb_to_hex:function(t,e,n){var i=this.hex_with_component(0,2,t);return i=this.hex_with_component(i,1,e),this.hex_with_component(i,0,n)},component_from_hex:function(t,e){return t>>8*e&255},hex_with_component:function(t,e,n){return n<<(v=8*e)|t&~(255<<v)}},w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},x=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},E=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),A=function t(e,n,i){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,n);if(void 0===o){var r=Object.getPrototypeOf(e);return null===r?void 0:t(r,n,i)}if("value"in o)return o.value;var s=o.get;return void 0!==s?s.call(i):void 0},C=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},B=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},k=function(){function t(){if(x(this,t),this.__state=b.apply(this,arguments),!1===this.__state)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return E(t,[{key:"toString",value:function(){return h(this)}},{key:"toHexString",value:function(){return h(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),t}();function P(t,e,n){Object.defineProperty(t,e,{get:function(){return"RGB"===this.__state.space||k.recalculateRGB(this,e,n),this.__state[e]},set:function(t){"RGB"!==this.__state.space&&(k.recalculateRGB(this,e,n),this.__state.space="RGB"),this.__state[e]=t}})}function T(t,e){Object.defineProperty(t,e,{get:function(){return"HSV"===this.__state.space||k.recalculateHSV(this),this.__state[e]},set:function(t){"HSV"!==this.__state.space&&(k.recalculateHSV(this),this.__state.space="HSV"),this.__state[e]=t}})}k.recalculateRGB=function(t,e,n){if("HEX"===t.__state.space)t.__state[e]=y.component_from_hex(t.__state.hex,n);else{if("HSV"!==t.__state.space)throw new Error("Corrupted color state");p.extend(t.__state,y.hsv_to_rgb(t.__state.h,t.__state.s,t.__state.v))}},k.recalculateHSV=function(t){var e=y.rgb_to_hsv(t.r,t.g,t.b);p.extend(t.__state,{s:e.s,v:e.v}),p.isNaN(e.h)?p.isUndefined(t.__state.h)&&(t.__state.h=0):t.__state.h=e.h},k.COMPONENTS=["r","g","b","h","s","v","hex","a"],P(k.prototype,"r",2),P(k.prototype,"g",1),P(k.prototype,"b",0),T(k.prototype,"h"),T(k.prototype,"s"),T(k.prototype,"v"),Object.defineProperty(k.prototype,"a",{get:function(){return this.__state.a},set:function(t){this.__state.a=t}}),Object.defineProperty(k.prototype,"hex",{get:function(){return"HEX"!==this.__state.space&&(this.__state.hex=y.rgb_to_hex(this.r,this.g,this.b),this.__state.space="HEX"),this.__state.hex},set:function(t){this.__state.space="HEX",this.__state.hex=t}});var M=function(){function t(e,n){x(this,t),this.initialValue=e[n],this.domElement=document.createElement("div"),this.object=e,this.property=n,this.__onChange=void 0,this.__onFinishChange=void 0}return E(t,[{key:"onChange",value:function(t){return this.__onChange=t,this}},{key:"onFinishChange",value:function(t){return this.__onFinishChange=t,this}},{key:"setValue",value:function(t){return this.object[this.property]=t,this.__onChange&&this.__onChange.call(this,t),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),t}(),R={};p.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},(function(t,e){p.each(t,(function(t){R[t]=e}))}));var S=/(\d+(\.\d+)?)px/;function L(t){if("0"===t||p.isUndefined(t))return 0;var e=t.match(S);return p.isNull(e)?0:parseFloat(e[1])}var O={makeSelectable:function(t,e){void 0!==t&&void 0!==t.style&&(t.onselectstart=e?function(){return!1}:function(){},t.style.MozUserSelect=e?"auto":"none",t.style.KhtmlUserSelect=e?"auto":"none",t.unselectable=e?"on":"off")},makeFullscreen:function(t,e,n){var i=n,o=e;p.isUndefined(o)&&(o=!0),p.isUndefined(i)&&(i=!0),t.style.position="absolute",o&&(t.style.left=0,t.style.right=0),i&&(t.style.top=0,t.style.bottom=0)},fakeEvent:function(t,e,n,i){var o=n||{},r=R[e];if(!r)throw new Error("Event type "+e+" not supported.");var s=document.createEvent(r);switch(r){case"MouseEvents":var a=o.x||o.clientX||0,l=o.y||o.clientY||0;s.initMouseEvent(e,o.bubbles||!1,o.cancelable||!0,window,o.clickCount||1,0,0,a,l,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var u=s.initKeyboardEvent||s.initKeyEvent;p.defaults(o,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),u(e,o.bubbles||!1,o.cancelable,window,o.ctrlKey,o.altKey,o.shiftKey,o.metaKey,o.keyCode,o.charCode);break;default:s.initEvent(e,o.bubbles||!1,o.cancelable||!0)}p.defaults(s,i),t.dispatchEvent(s)},bind:function(t,e,n,i){var o=i||!1;return t.addEventListener?t.addEventListener(e,n,o):t.attachEvent&&t.attachEvent("on"+e,n),O},unbind:function(t,e,n,i){var o=i||!1;return t.removeEventListener?t.removeEventListener(e,n,o):t.detachEvent&&t.detachEvent("on"+e,n),O},addClass:function(t,e){if(void 0===t.className)t.className=e;else if(t.className!==e){var n=t.className.split(/ +/);-1===n.indexOf(e)&&(n.push(e),t.className=n.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return O},removeClass:function(t,e){if(e)if(t.className===e)t.removeAttribute("class");else{var n=t.className.split(/ +/),i=n.indexOf(e);-1!==i&&(n.splice(i,1),t.className=n.join(" "))}else t.className=void 0;return O},hasClass:function(t,e){return new RegExp("(?:^|\\s+)"+e+"(?:\\s+|$)").test(t.className)||!1},getWidth:function(t){var e=getComputedStyle(t);return L(e["border-left-width"])+L(e["border-right-width"])+L(e["padding-left"])+L(e["padding-right"])+L(e.width)},getHeight:function(t){var e=getComputedStyle(t);return L(e["border-top-width"])+L(e["border-bottom-width"])+L(e["padding-top"])+L(e["padding-bottom"])+L(e.height)},getOffset:function(t){var e=t,n={left:0,top:0};if(e.offsetParent)do{n.left+=e.offsetLeft,n.top+=e.offsetTop,e=e.offsetParent}while(e);return n},isActive:function(t){return t===document.activeElement&&(t.type||t.href)}},I=function(t){function e(t,n){x(this,e);var i=B(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),o=i;return i.__prev=i.getValue(),i.__checkbox=document.createElement("input"),i.__checkbox.setAttribute("type","checkbox"),O.bind(i.__checkbox,"change",(function(){o.setValue(!o.__prev)}),!1),i.domElement.appendChild(i.__checkbox),i.updateDisplay(),i}return C(e,t),E(e,[{key:"setValue",value:function(t){var n=A(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,t);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),n}},{key:"updateDisplay",value:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),A(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(M),D=function(t){function e(t,n,i){x(this,e);var o=B(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),r=i,s=o;if(o.__select=document.createElement("select"),p.isArray(r)){var a={};p.each(r,(function(t){a[t]=t})),r=a}return p.each(r,(function(t,e){var n=document.createElement("option");n.innerHTML=e,n.setAttribute("value",t),s.__select.appendChild(n)})),o.updateDisplay(),O.bind(o.__select,"change",(function(){var t=this.options[this.selectedIndex].value;s.setValue(t)})),o.domElement.appendChild(o.__select),o}return C(e,t),E(e,[{key:"setValue",value:function(t){var n=A(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,t);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),n}},{key:"updateDisplay",value:function(){return O.isActive(this.__select)?this:(this.__select.value=this.getValue(),A(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this))}}]),e}(M),N=function(t){function e(t,n){x(this,e);var i=B(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),o=i;function r(){o.setValue(o.__input.value)}return i.__input=document.createElement("input"),i.__input.setAttribute("type","text"),O.bind(i.__input,"keyup",r),O.bind(i.__input,"change",r),O.bind(i.__input,"blur",(function(){o.__onFinishChange&&o.__onFinishChange.call(o,o.getValue())})),O.bind(i.__input,"keydown",(function(t){13===t.keyCode&&this.blur()})),i.updateDisplay(),i.domElement.appendChild(i.__input),i}return C(e,t),E(e,[{key:"updateDisplay",value:function(){return O.isActive(this.__input)||(this.__input.value=this.getValue()),A(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(M);function U(t){var e=t.toString();return e.indexOf(".")>-1?e.length-e.indexOf(".")-1:0}var F=function(t){function e(t,n,i){x(this,e);var o=B(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),r=i||{};return o.__min=r.min,o.__max=r.max,o.__step=r.step,p.isUndefined(o.__step)?0===o.initialValue?o.__impliedStep=1:o.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(o.initialValue))/Math.LN10))/10:o.__impliedStep=o.__step,o.__precision=U(o.__impliedStep),o}return C(e,t),E(e,[{key:"setValue",value:function(t){var n=t;return void 0!==this.__min&&n<this.__min?n=this.__min:void 0!==this.__max&&n>this.__max&&(n=this.__max),void 0!==this.__step&&n%this.__step!=0&&(n=Math.round(n/this.__step)*this.__step),A(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,n)}},{key:"min",value:function(t){return this.__min=t,this}},{key:"max",value:function(t){return this.__max=t,this}},{key:"step",value:function(t){return this.__step=t,this.__impliedStep=t,this.__precision=U(t),this}}]),e}(M),V=function(t){function e(t,n,i){x(this,e);var o=B(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,i));o.__truncationSuspended=!1;var r=o,s=void 0;function a(){r.__onFinishChange&&r.__onFinishChange.call(r,r.getValue())}function l(t){var e=s-t.clientY;r.setValue(r.getValue()+e*r.__impliedStep),s=t.clientY}function u(){O.unbind(window,"mousemove",l),O.unbind(window,"mouseup",u),a()}return o.__input=document.createElement("input"),o.__input.setAttribute("type","text"),O.bind(o.__input,"change",(function(){var t=parseFloat(r.__input.value);p.isNaN(t)||r.setValue(t)})),O.bind(o.__input,"blur",(function(){a()})),O.bind(o.__input,"mousedown",(function(t){O.bind(window,"mousemove",l),O.bind(window,"mouseup",u),s=t.clientY})),O.bind(o.__input,"keydown",(function(t){13===t.keyCode&&(r.__truncationSuspended=!0,this.blur(),r.__truncationSuspended=!1,a())})),o.updateDisplay(),o.domElement.appendChild(o.__input),o}return C(e,t),E(e,[{key:"updateDisplay",value:function(){var t,n,i;return this.__input.value=this.__truncationSuspended?this.getValue():(t=this.getValue(),n=this.__precision,i=Math.pow(10,n),Math.round(t*i)/i),A(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(F);function H(t,e,n,i,o){return i+(t-e)/(n-e)*(o-i)}var G=function(t){function e(t,n,i,o,r){x(this,e);var s=B(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,{min:i,max:o,step:r})),a=s;function l(t){t.preventDefault();var e=a.__background.getBoundingClientRect();return a.setValue(H(t.clientX,e.left,e.right,a.__min,a.__max)),!1}function u(){O.unbind(window,"mousemove",l),O.unbind(window,"mouseup",u),a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())}function d(t){var e=t.touches[0].clientX,n=a.__background.getBoundingClientRect();a.setValue(H(e,n.left,n.right,a.__min,a.__max))}function h(){O.unbind(window,"touchmove",d),O.unbind(window,"touchend",h),a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())}return s.__background=document.createElement("div"),s.__foreground=document.createElement("div"),O.bind(s.__background,"mousedown",(function(t){document.activeElement.blur(),O.bind(window,"mousemove",l),O.bind(window,"mouseup",u),l(t)})),O.bind(s.__background,"touchstart",(function(t){1===t.touches.length&&(O.bind(window,"touchmove",d),O.bind(window,"touchend",h),d(t))})),O.addClass(s.__background,"slider"),O.addClass(s.__foreground,"slider-fg"),s.updateDisplay(),s.__background.appendChild(s.__foreground),s.domElement.appendChild(s.__background),s}return C(e,t),E(e,[{key:"updateDisplay",value:function(){var t=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*t+"%",A(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(F),j=function(t){function e(t,n,i){x(this,e);var o=B(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),r=o;return o.__button=document.createElement("div"),o.__button.innerHTML=void 0===i?"Fire":i,O.bind(o.__button,"click",(function(t){return t.preventDefault(),r.fire(),!1})),O.addClass(o.__button,"button"),o.domElement.appendChild(o.__button),o}return C(e,t),E(e,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),e}(M),z=function(t){function e(t,n){x(this,e);var i=B(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));i.__color=new k(i.getValue()),i.__temp=new k(0);var o=i;i.domElement=document.createElement("div"),O.makeSelectable(i.domElement,!1),i.__selector=document.createElement("div"),i.__selector.className="selector",i.__saturation_field=document.createElement("div"),i.__saturation_field.className="saturation-field",i.__field_knob=document.createElement("div"),i.__field_knob.className="field-knob",i.__field_knob_border="2px solid ",i.__hue_knob=document.createElement("div"),i.__hue_knob.className="hue-knob",i.__hue_field=document.createElement("div"),i.__hue_field.className="hue-field",i.__input=document.createElement("input"),i.__input.type="text",i.__input_textShadow="0 1px 1px ",O.bind(i.__input,"keydown",(function(t){13===t.keyCode&&h.call(this)})),O.bind(i.__input,"blur",h),O.bind(i.__selector,"mousedown",(function(){O.addClass(this,"drag").bind(window,"mouseup",(function(){O.removeClass(o.__selector,"drag")}))})),O.bind(i.__selector,"touchstart",(function(){O.addClass(this,"drag").bind(window,"touchend",(function(){O.removeClass(o.__selector,"drag")}))}));var r,s=document.createElement("div");function a(t){f(t),O.bind(window,"mousemove",f),O.bind(window,"touchmove",f),O.bind(window,"mouseup",u),O.bind(window,"touchend",u)}function l(t){_(t),O.bind(window,"mousemove",_),O.bind(window,"touchmove",_),O.bind(window,"mouseup",d),O.bind(window,"touchend",d)}function u(){O.unbind(window,"mousemove",f),O.unbind(window,"touchmove",f),O.unbind(window,"mouseup",u),O.unbind(window,"touchend",u),c()}function d(){O.unbind(window,"mousemove",_),O.unbind(window,"touchmove",_),O.unbind(window,"mouseup",d),O.unbind(window,"touchend",d),c()}function h(){var t=b(this.value);!1!==t?(o.__color.__state=t,o.setValue(o.__color.toOriginal())):this.value=o.__color.toString()}function c(){o.__onFinishChange&&o.__onFinishChange.call(o,o.__color.toOriginal())}function f(t){-1===t.type.indexOf("touch")&&t.preventDefault();var e=o.__saturation_field.getBoundingClientRect(),n=t.touches&&t.touches[0]||t,i=n.clientX,r=n.clientY,s=(i-e.left)/(e.right-e.left),a=1-(r-e.top)/(e.bottom-e.top);return a>1?a=1:a<0&&(a=0),s>1?s=1:s<0&&(s=0),o.__color.v=a,o.__color.s=s,o.setValue(o.__color.toOriginal()),!1}function _(t){-1===t.type.indexOf("touch")&&t.preventDefault();var e=o.__hue_field.getBoundingClientRect(),n=1-((t.touches&&t.touches[0]||t).clientY-e.top)/(e.bottom-e.top);return n>1?n=1:n<0&&(n=0),o.__color.h=360*n,o.setValue(o.__color.toOriginal()),!1}return p.extend(i.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),p.extend(i.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:i.__field_knob_border+(i.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),p.extend(i.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),p.extend(i.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),p.extend(s.style,{width:"100%",height:"100%",background:"none"}),Y(s,"top","rgba(0,0,0,0)","#000"),p.extend(i.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),(r=i.__hue_field).style.background="",r.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",r.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",r.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",r.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",r.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",p.extend(i.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:i.__input_textShadow+"rgba(0,0,0,0.7)"}),O.bind(i.__saturation_field,"mousedown",a),O.bind(i.__saturation_field,"touchstart",a),O.bind(i.__field_knob,"mousedown",a),O.bind(i.__field_knob,"touchstart",a),O.bind(i.__hue_field,"mousedown",l),O.bind(i.__hue_field,"touchstart",l),i.__saturation_field.appendChild(s),i.__selector.appendChild(i.__field_knob),i.__selector.appendChild(i.__saturation_field),i.__selector.appendChild(i.__hue_field),i.__hue_field.appendChild(i.__hue_knob),i.domElement.appendChild(i.__input),i.domElement.appendChild(i.__selector),i.updateDisplay(),i}return C(e,t),E(e,[{key:"updateDisplay",value:function(){var t=b(this.getValue());if(!1!==t){var e=!1;p.each(k.COMPONENTS,(function(n){if(!p.isUndefined(t[n])&&!p.isUndefined(this.__color.__state[n])&&t[n]!==this.__color.__state[n])return e=!0,{}}),this),e&&p.extend(this.__color.__state,t)}p.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var n=this.__color.v<.5||this.__color.s>.5?255:0,i=255-n;p.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+n+","+n+","+n+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,Y(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),p.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+n+","+n+","+n+")",textShadow:this.__input_textShadow+"rgba("+i+","+i+","+i+",.7)"})}}]),e}(M),X=["-moz-","-o-","-webkit-","-ms-",""];function Y(t,e,n,i){t.style.background="",p.each(X,(function(o){t.style.cssText+="background: "+o+"linear-gradient("+e+", "+n+" 0%, "+i+" 100%); "}))}var W=function(t,e){var n=t[e];return p.isArray(arguments[2])||p.isObject(arguments[2])?new D(t,e,arguments[2]):p.isNumber(n)?p.isNumber(arguments[2])&&p.isNumber(arguments[3])?p.isNumber(arguments[4])?new G(t,e,arguments[2],arguments[3],arguments[4]):new G(t,e,arguments[2],arguments[3]):p.isNumber(arguments[4])?new V(t,e,{min:arguments[2],max:arguments[3],step:arguments[4]}):new V(t,e,{min:arguments[2],max:arguments[3]}):p.isString(n)?new N(t,e):p.isFunction(n)?new j(t,e,""):p.isBoolean(n)?new I(t,e):null},K=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){setTimeout(t,1e3/60)},J=function(){function t(){x(this,t),this.backgroundElement=document.createElement("div"),p.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),O.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),p.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var e=this;O.bind(this.backgroundElement,"click",(function(){e.hide()}))}return E(t,[{key:"show",value:function(){var t=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),p.defer((function(){t.backgroundElement.style.opacity=1,t.domElement.style.opacity=1,t.domElement.style.webkitTransform="scale(1)"}))}},{key:"hide",value:function(){var t=this,e=function e(){t.domElement.style.display="none",t.backgroundElement.style.display="none",O.unbind(t.domElement,"webkitTransitionEnd",e),O.unbind(t.domElement,"transitionend",e),O.unbind(t.domElement,"oTransitionEnd",e)};O.bind(this.domElement,"webkitTransitionEnd",e),O.bind(this.domElement,"transitionend",e),O.bind(this.domElement,"oTransitionEnd",e),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-O.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-O.getHeight(this.domElement)/2+"px"}}]),t}();!function(t,e){var n=e||document,i=document.createElement("style");i.type="text/css",i.innerHTML=t;var o=n.getElementsByTagName("head")[0];try{o.appendChild(i)}catch(t){}}(function(t){if(t&&"undefined"!=typeof window){var e=document.createElement("style");return e.setAttribute("type","text/css"),e.innerHTML=t,document.head.appendChild(e),t}}(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .cr.function .property-name{width:100%}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n"));var Q="Default",q=function(){try{return!!window.localStorage}catch(t){return!1}}(),Z=void 0,$=!0,tt=void 0,et=!1,nt=[],it=function t(e){var n=this,i=e||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),O.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],i=p.defaults(i,{closeOnTop:!1,autoPlace:!0,width:t.DEFAULT_WIDTH}),i=p.defaults(i,{resizable:i.autoPlace,hideable:i.autoPlace}),p.isUndefined(i.load)?i.load={preset:Q}:i.preset&&(i.load.preset=i.preset),p.isUndefined(i.parent)&&i.hideable&&nt.push(this),i.resizable=p.isUndefined(i.parent)&&i.resizable,i.autoPlace&&p.isUndefined(i.scrollable)&&(i.scrollable=!0);var o,r=q&&"true"===localStorage.getItem(ut(0,"isLocal")),s=void 0,a=void 0;if(Object.defineProperties(this,{parent:{get:function(){return i.parent}},scrollable:{get:function(){return i.scrollable}},autoPlace:{get:function(){return i.autoPlace}},closeOnTop:{get:function(){return i.closeOnTop}},preset:{get:function(){return n.parent?n.getRoot().preset:i.load.preset},set:function(t){n.parent?n.getRoot().preset=t:i.load.preset=t,function(t){for(var e=0;e<t.__preset_select.length;e++)t.__preset_select[e].value===t.preset&&(t.__preset_select.selectedIndex=e)}(this),n.revert()}},width:{get:function(){return i.width},set:function(t){i.width=t,ft(n,t)}},name:{get:function(){return i.name},set:function(t){i.name=t,a&&(a.innerHTML=i.name)}},closed:{get:function(){return i.closed},set:function(e){i.closed=e,i.closed?O.addClass(n.__ul,t.CLASS_CLOSED):O.removeClass(n.__ul,t.CLASS_CLOSED),this.onResize(),n.__closeButton&&(n.__closeButton.innerHTML=e?t.TEXT_OPEN:t.TEXT_CLOSED)}},load:{get:function(){return i.load}},useLocalStorage:{get:function(){return r},set:function(t){q&&(r=t,t?O.bind(window,"unload",s):O.unbind(window,"unload",s),localStorage.setItem(ut(0,"isLocal"),t))}}}),p.isUndefined(i.parent)){if(this.closed=i.closed||!1,O.addClass(this.domElement,t.CLASS_MAIN),O.makeSelectable(this.domElement,!1),q&&r){n.useLocalStorage=!0;var l=localStorage.getItem(ut(0,"gui"));l&&(i.load=JSON.parse(l))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=t.TEXT_CLOSED,O.addClass(this.__closeButton,t.CLASS_CLOSE_BUTTON),i.closeOnTop?(O.addClass(this.__closeButton,t.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(O.addClass(this.__closeButton,t.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),O.bind(this.__closeButton,"click",(function(){n.closed=!n.closed}))}else{void 0===i.closed&&(i.closed=!0);var u=document.createTextNode(i.name);O.addClass(u,"controller-name"),a=ot(n,u),O.addClass(this.__ul,t.CLASS_CLOSED),O.addClass(a,"title"),O.bind(a,"click",(function(t){return t.preventDefault(),n.closed=!n.closed,!1})),i.closed||(this.closed=!1)}i.autoPlace&&(p.isUndefined(i.parent)&&($&&(tt=document.createElement("div"),O.addClass(tt,"dg"),O.addClass(tt,t.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(tt),$=!1),tt.appendChild(this.domElement),O.addClass(this.domElement,t.CLASS_AUTO_PLACE)),this.parent||ft(n,i.width)),this.__resizeHandler=function(){n.onResizeDebounced()},O.bind(window,"resize",this.__resizeHandler),O.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),O.bind(this.__ul,"transitionend",this.__resizeHandler),O.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),i.resizable&&ct(this),s=function(){q&&"true"===localStorage.getItem(ut(0,"isLocal"))&&localStorage.setItem(ut(0,"gui"),JSON.stringify(n.getSaveObject()))},this.saveToLocalStorageIfPossible=s,i.parent||((o=n.getRoot()).width+=1,p.defer((function(){o.width-=1})))};function ot(t,e,n){var i=document.createElement("li");return e&&i.appendChild(e),n?t.__ul.insertBefore(i,n):t.__ul.appendChild(i),t.onResize(),i}function rt(t){O.unbind(window,"resize",t.__resizeHandler),t.saveToLocalStorageIfPossible&&O.unbind(window,"unload",t.saveToLocalStorageIfPossible)}function st(t,e){var n=t.__preset_select[t.__preset_select.selectedIndex];n.innerHTML=e?n.value+"*":n.value}function at(t,e){var n=t.getRoot(),i=n.__rememberedObjects.indexOf(e.object);if(-1!==i){var o=n.__rememberedObjectIndecesToControllers[i];if(void 0===o&&(o={},n.__rememberedObjectIndecesToControllers[i]=o),o[e.property]=e,n.load&&n.load.remembered){var r=n.load.remembered,s=void 0;if(r[t.preset])s=r[t.preset];else{if(!r[Q])return;s=r[Q]}if(s[i]&&void 0!==s[i][e.property]){var a=s[i][e.property];e.initialValue=a,e.setValue(a)}}}}function lt(t,e,n,i){if(void 0===e[n])throw new Error('Object "'+e+'" has no property "'+n+'"');var o=void 0;if(i.color)o=new z(e,n);else{var r=[e,n].concat(i.factoryArgs);o=W.apply(t,r)}i.before instanceof M&&(i.before=i.before.__li),at(t,o),O.addClass(o.domElement,"c");var s=document.createElement("span");O.addClass(s,"property-name"),s.innerHTML=o.property;var a=document.createElement("div");a.appendChild(s),a.appendChild(o.domElement);var l=ot(t,a,i.before);return O.addClass(l,it.CLASS_CONTROLLER_ROW),o instanceof z?O.addClass(l,"color"):O.addClass(l,w(o.getValue())),function(t,e,n){if(n.__li=e,n.__gui=t,p.extend(n,{options:function(e){if(arguments.length>1){var i=n.__li.nextElementSibling;return n.remove(),lt(t,n.object,n.property,{before:i,factoryArgs:[p.toArray(arguments)]})}if(p.isArray(e)||p.isObject(e)){var o=n.__li.nextElementSibling;return n.remove(),lt(t,n.object,n.property,{before:o,factoryArgs:[e]})}},name:function(t){return n.__li.firstElementChild.firstElementChild.innerHTML=t,n},listen:function(){return n.__gui.listen(n),n},remove:function(){return n.__gui.remove(n),n}}),n instanceof G){var i=new V(n.object,n.property,{min:n.__min,max:n.__max,step:n.__step});p.each(["updateDisplay","onChange","onFinishChange","step","min","max"],(function(t){var e=n[t],o=i[t];n[t]=i[t]=function(){var t=Array.prototype.slice.call(arguments);return o.apply(i,t),e.apply(n,t)}})),O.addClass(e,"has-slider"),n.domElement.insertBefore(i.domElement,n.domElement.firstElementChild)}else if(n instanceof V){var o=function(e){if(p.isNumber(n.__min)&&p.isNumber(n.__max)){var i=n.__li.firstElementChild.firstElementChild.innerHTML,o=n.__gui.__listening.indexOf(n)>-1;n.remove();var r=lt(t,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[n.__min,n.__max,n.__step]});return r.name(i),o&&r.listen(),r}return e};n.min=p.compose(o,n.min),n.max=p.compose(o,n.max)}else n instanceof I?(O.bind(e,"click",(function(){O.fakeEvent(n.__checkbox,"click")})),O.bind(n.__checkbox,"click",(function(t){t.stopPropagation()}))):n instanceof j?(O.bind(e,"click",(function(){O.fakeEvent(n.__button,"click")})),O.bind(e,"mouseover",(function(){O.addClass(n.__button,"hover")})),O.bind(e,"mouseout",(function(){O.removeClass(n.__button,"hover")}))):n instanceof z&&(O.addClass(e,"color"),n.updateDisplay=p.compose((function(t){return e.style.borderLeftColor=n.__color.toString(),t}),n.updateDisplay),n.updateDisplay());n.setValue=p.compose((function(e){return t.getRoot().__preset_select&&n.isModified()&&st(t.getRoot(),!0),e}),n.setValue)}(t,l,o),t.__controllers.push(o),o}function ut(t,e){return document.location.href+"."+e}function dt(t,e,n){var i=document.createElement("option");i.innerHTML=e,i.value=e,t.__preset_select.appendChild(i),n&&(t.__preset_select.selectedIndex=t.__preset_select.length-1)}function ht(t,e){e.style.display=t.useLocalStorage?"block":"none"}function ct(t){var e=void 0;function n(n){return n.preventDefault(),t.width+=e-n.clientX,t.onResize(),e=n.clientX,!1}function i(){O.removeClass(t.__closeButton,it.CLASS_DRAG),O.unbind(window,"mousemove",n),O.unbind(window,"mouseup",i)}function o(o){return o.preventDefault(),e=o.clientX,O.addClass(t.__closeButton,it.CLASS_DRAG),O.bind(window,"mousemove",n),O.bind(window,"mouseup",i),!1}t.__resize_handle=document.createElement("div"),p.extend(t.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),O.bind(t.__resize_handle,"mousedown",o),O.bind(t.__closeButton,"mousedown",o),t.domElement.insertBefore(t.__resize_handle,t.domElement.firstElementChild)}function ft(t,e){t.domElement.style.width=e+"px",t.__save_row&&t.autoPlace&&(t.__save_row.style.width=e+"px"),t.__closeButton&&(t.__closeButton.style.width=e+"px")}function pt(t,e){var n={};return p.each(t.__rememberedObjects,(function(i,o){var r={},s=t.__rememberedObjectIndecesToControllers[o];p.each(s,(function(t,n){r[n]=e?t.initialValue:t.getValue()})),n[o]=r})),n}function _t(t){0!==t.length&&K.call(window,(function(){_t(t)})),p.each(t,(function(t){t.updateDisplay()}))}it.toggleHide=function(){et=!et,p.each(nt,(function(t){t.domElement.style.display=et?"none":""}))},it.CLASS_AUTO_PLACE="a",it.CLASS_AUTO_PLACE_CONTAINER="ac",it.CLASS_MAIN="main",it.CLASS_CONTROLLER_ROW="cr",it.CLASS_TOO_TALL="taller-than-window",it.CLASS_CLOSED="closed",it.CLASS_CLOSE_BUTTON="close-button",it.CLASS_CLOSE_TOP="close-top",it.CLASS_CLOSE_BOTTOM="close-bottom",it.CLASS_DRAG="drag",it.DEFAULT_WIDTH=245,it.TEXT_CLOSED="Close Controls",it.TEXT_OPEN="Open Controls",it._keydownHandler=function(t){"text"===document.activeElement.type||72!==t.which&&72!==t.keyCode||it.toggleHide()},O.bind(window,"keydown",it._keydownHandler,!1),p.extend(it.prototype,{add:function(t,e){return lt(this,t,e,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(t,e){return lt(this,t,e,{color:!0})},remove:function(t){this.__ul.removeChild(t.__li),this.__controllers.splice(this.__controllers.indexOf(t),1);var e=this;p.defer((function(){e.onResize()}))},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&tt.removeChild(this.domElement);var t=this;p.each(this.__folders,(function(e){t.removeFolder(e)})),O.unbind(window,"keydown",it._keydownHandler,!1),rt(this)},addFolder:function(t){if(void 0!==this.__folders[t])throw new Error('You already have a folder in this GUI by the name "'+t+'"');var e={name:t,parent:this};e.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[t]&&(e.closed=this.load.folders[t].closed,e.load=this.load.folders[t]);var n=new it(e);this.__folders[t]=n;var i=ot(this,n.domElement);return O.addClass(i,"folder"),n},removeFolder:function(t){this.__ul.removeChild(t.domElement.parentElement),delete this.__folders[t.name],this.load&&this.load.folders&&this.load.folders[t.name]&&delete this.load.folders[t.name],rt(t);var e=this;p.each(t.__folders,(function(e){t.removeFolder(e)})),p.defer((function(){e.onResize()}))},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var t=this.getRoot();if(t.scrollable){var e=O.getOffset(t.__ul).top,n=0;p.each(t.__ul.childNodes,(function(e){t.autoPlace&&e===t.__save_row||(n+=O.getHeight(e))})),window.innerHeight-e-20<n?(O.addClass(t.domElement,it.CLASS_TOO_TALL),t.__ul.style.height=window.innerHeight-e-20+"px"):(O.removeClass(t.domElement,it.CLASS_TOO_TALL),t.__ul.style.height="auto")}t.__resize_handle&&p.defer((function(){t.__resize_handle.style.height=t.__ul.offsetHeight+"px"})),t.__closeButton&&(t.__closeButton.style.width=t.width+"px")},onResizeDebounced:p.debounce((function(){this.onResize()}),50),remember:function(){if(p.isUndefined(Z)&&((Z=new J).domElement.innerHTML='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>'),this.parent)throw new Error("You can only call remember on a top level GUI.");var t=this;p.each(Array.prototype.slice.call(arguments),(function(e){0===t.__rememberedObjects.length&&function(t){var e=t.__save_row=document.createElement("li");O.addClass(t.domElement,"has-save"),t.__ul.insertBefore(e,t.__ul.firstChild),O.addClass(e,"save-row");var n=document.createElement("span");n.innerHTML="&nbsp;",O.addClass(n,"button gears");var i=document.createElement("span");i.innerHTML="Save",O.addClass(i,"button"),O.addClass(i,"save");var o=document.createElement("span");o.innerHTML="New",O.addClass(o,"button"),O.addClass(o,"save-as");var r=document.createElement("span");r.innerHTML="Revert",O.addClass(r,"button"),O.addClass(r,"revert");var s=t.__preset_select=document.createElement("select");if(t.load&&t.load.remembered?p.each(t.load.remembered,(function(e,n){dt(t,n,n===t.preset)})):dt(t,Q,!1),O.bind(s,"change",(function(){for(var e=0;e<t.__preset_select.length;e++)t.__preset_select[e].innerHTML=t.__preset_select[e].value;t.preset=this.value})),e.appendChild(s),e.appendChild(n),e.appendChild(i),e.appendChild(o),e.appendChild(r),q){var a=document.getElementById("dg-local-explain"),l=document.getElementById("dg-local-storage");document.getElementById("dg-save-locally").style.display="block","true"===localStorage.getItem(ut(0,"isLocal"))&&l.setAttribute("checked","checked"),ht(t,a),O.bind(l,"change",(function(){t.useLocalStorage=!t.useLocalStorage,ht(t,a)}))}var u=document.getElementById("dg-new-constructor");O.bind(u,"keydown",(function(t){!t.metaKey||67!==t.which&&67!==t.keyCode||Z.hide()})),O.bind(n,"click",(function(){u.innerHTML=JSON.stringify(t.getSaveObject(),void 0,2),Z.show(),u.focus(),u.select()})),O.bind(i,"click",(function(){t.save()})),O.bind(o,"click",(function(){var e=prompt("Enter a new preset name.");e&&t.saveAs(e)})),O.bind(r,"click",(function(){t.revert()}))}(t),-1===t.__rememberedObjects.indexOf(e)&&t.__rememberedObjects.push(e)})),this.autoPlace&&ft(this,this.width)},getRoot:function(){for(var t=this;t.parent;)t=t.parent;return t},getSaveObject:function(){var t=this.load;return t.closed=this.closed,this.__rememberedObjects.length>0&&(t.preset=this.preset,t.remembered||(t.remembered={}),t.remembered[this.preset]=pt(this)),t.folders={},p.each(this.__folders,(function(e,n){t.folders[n]=e.getSaveObject()})),t},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=pt(this),st(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(t){this.load.remembered||(this.load.remembered={},this.load.remembered[Q]=pt(this,!0)),this.load.remembered[t]=pt(this),this.preset=t,dt(this,t,!0),this.saveToLocalStorageIfPossible()},revert:function(t){p.each(this.__controllers,(function(e){this.getRoot().load.remembered?at(t||this.getRoot(),e):e.setValue(e.initialValue),e.__onFinishChange&&e.__onFinishChange.call(e,e.getValue())}),this),p.each(this.__folders,(function(t){t.revert(t)})),t||st(this.getRoot(),!1)},listen:function(t){var e=0===this.__listening.length;this.__listening.push(t),e&&_t(this.__listening)},updateDisplay:function(){p.each(this.__controllers,(function(t){t.updateDisplay()})),p.each(this.__folders,(function(t){t.updateDisplay()}))}});var gt=it;function mt(){var t=new e(4);return e!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function bt(t,n,i,o){var r=new e(4);return r[0]=t,r[1]=n,r[2]=i,r[3]=o,r}function vt(t,e){var n=e[0],i=e[1],o=e[2],r=e[3],s=n*n+i*i+o*o+r*r;return s>0&&(s=1/Math.sqrt(s)),t[0]=n*s,t[1]=i*s,t[2]=o*s,t[3]=r*s,t}function yt(t,e,n){var i=e[0],o=e[1],r=e[2],s=e[3];return t[0]=n[0]*i+n[4]*o+n[8]*r+n[12]*s,t[1]=n[1]*i+n[5]*o+n[9]*r+n[13]*s,t[2]=n[2]*i+n[6]*o+n[10]*r+n[14]*s,t[3]=n[3]*i+n[7]*o+n[11]*r+n[15]*s,t}mt();class wt{constructor(t=1,e=8){this.radius=t,this.definition=e}getPosition(t){const e=2*t*Math.PI;return bt(this.radius*Math.cos(e),this.radius*Math.sin(e),0,1)}getArrays(){const t=1/this.definition,e=[],n=[],i=[];for(let o=0;o<=this.definition;o++){const r=this.getPosition(o*t),s=mt();vt(s,r),e.push(r),n.push(s),i.push(r[0]/this.radius+this.radius,r[1]/this.radius+this.radius)}return{positionArray:e,normalArray:n,uvArray:i}}}function xt(){var t=new e(3);return e!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Et(t,n,i){var o=new e(3);return o[0]=t,o[1]=n,o[2]=i,o}function At(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function Ct(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function Bt(t,e){var n=e[0],i=e[1],o=e[2],r=n*n+i*i+o*o;return r>0&&(r=1/Math.sqrt(r)),t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function kt(t,e,n,i){var o=[],r=[];return o[0]=e[0]-n[0],o[1]=e[1]-n[1],o[2]=e[2]-n[2],r[0]=o[2]*Math.sin(i)+o[0]*Math.cos(i),r[1]=o[1],r[2]=o[2]*Math.cos(i)-o[0]*Math.sin(i),t[0]=r[0]+n[0],t[1]=r[1]+n[1],t[2]=r[2]+n[2],t}function Pt(t,e,n,i){var o=[],r=[];return o[0]=e[0]-n[0],o[1]=e[1]-n[1],o[2]=e[2]-n[2],r[0]=o[0]*Math.cos(i)-o[1]*Math.sin(i),r[1]=o[0]*Math.sin(i)+o[1]*Math.cos(i),r[2]=o[2],t[0]=r[0]+n[0],t[1]=r[1]+n[1],t[2]=r[2]+n[2],t}function Tt(t,e){var n=t[0],i=t[1],o=t[2],r=e[0],s=e[1],a=e[2],l=Math.sqrt(n*n+i*i+o*o)*Math.sqrt(r*r+s*s+a*a),u=l&&function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}(t,e)/l;return Math.acos(Math.min(Math.max(u,-1),1))}xt();class Mt{constructor(t,e,i,o,s,a,l=!0){this.modelMatrix=n(),this.translationVector=Et(0,0,0),this.rotationAxis=Et(1,0,0),this.rotationDegree=0,this.scalingVector=Et(1,1,1),this.children=[],this.drawMode=t,this.positionBuffer=e||null,this.normalBuffer=i||null,this.indexBuffer=o,this.uvBuffer=s||null,this.texture=a||null,this.affectedByLighting=l,r(this.modelMatrix)}addChild(t){this.children.push(t)}updateModelMatrix(){var t,e,n,i,o,r,s,a,u,d,h,c,f,p,_,g,m,b;t=this.modelMatrix,e=this.modelMatrix,g=(n=this.translationVector)[0],m=n[1],b=n[2],e===t?(t[12]=e[0]*g+e[4]*m+e[8]*b+e[12],t[13]=e[1]*g+e[5]*m+e[9]*b+e[13],t[14]=e[2]*g+e[6]*m+e[10]*b+e[14],t[15]=e[3]*g+e[7]*m+e[11]*b+e[15]):(i=e[0],o=e[1],r=e[2],s=e[3],a=e[4],u=e[5],d=e[6],h=e[7],c=e[8],f=e[9],p=e[10],_=e[11],t[0]=i,t[1]=o,t[2]=r,t[3]=s,t[4]=a,t[5]=u,t[6]=d,t[7]=h,t[8]=c,t[9]=f,t[10]=p,t[11]=_,t[12]=i*g+a*m+c*b+e[12],t[13]=o*g+u*m+f*b+e[13],t[14]=r*g+d*m+p*b+e[14],t[15]=s*g+h*m+_*b+e[15]),l(this.modelMatrix,this.modelMatrix,this.rotationDegree,this.rotationAxis),function(t,e,n){var i=n[0],o=n[1],r=n[2];t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*o,t[5]=e[5]*o,t[6]=e[6]*o,t[7]=e[7]*o,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]}(this.modelMatrix,this.modelMatrix,this.scalingVector)}draw(t,i,o,r,l,u){this.updateModelMatrix();let d=n();if(function(t,e,n){var i=e[0],o=e[1],r=e[2],s=e[3],a=e[4],l=e[5],u=e[6],d=e[7],h=e[8],c=e[9],f=e[10],p=e[11],_=e[12],g=e[13],m=e[14],b=e[15],v=n[0],y=n[1],w=n[2],x=n[3];t[0]=v*i+y*a+w*h+x*_,t[1]=v*o+y*l+w*c+x*g,t[2]=v*r+y*u+w*f+x*m,t[3]=v*s+y*d+w*p+x*b,v=n[4],y=n[5],w=n[6],x=n[7],t[4]=v*i+y*a+w*h+x*_,t[5]=v*o+y*l+w*c+x*g,t[6]=v*r+y*u+w*f+x*m,t[7]=v*s+y*d+w*p+x*b,v=n[8],y=n[9],w=n[10],x=n[11],t[8]=v*i+y*a+w*h+x*_,t[9]=v*o+y*l+w*c+x*g,t[10]=v*r+y*u+w*f+x*m,t[11]=v*s+y*d+w*p+x*b,v=n[12],y=n[13],w=n[14],x=n[15],t[12]=v*i+y*a+w*h+x*_,t[13]=v*o+y*l+w*c+x*g,t[14]=v*r+y*u+w*f+x*m,t[15]=v*s+y*d+w*p+x*b}(d,o,this.modelMatrix),this.drawMode&&this.positionBuffer&&this.normalBuffer&&this.indexBuffer){let n=(_=d,(g=new e(16))[0]=_[0],g[1]=_[1],g[2]=_[2],g[3]=_[3],g[4]=_[4],g[5]=_[5],g[6]=_[6],g[7]=_[7],g[8]=_[8],g[9]=_[9],g[10]=_[10],g[11]=_[11],g[12]=_[12],g[13]=_[13],g[14]=_[14],g[15]=_[15],g);a(n,n),s(n,n);var h=t.getUniformLocation(i,"modelMatrix"),c=t.getUniformLocation(i,"viewMatrix"),f=t.getUniformLocation(i,"projMatrix"),p=t.getUniformLocation(i,"normalMatrix");t.uniformMatrix4fv(h,!1,d),t.uniformMatrix4fv(c,!1,r),t.uniformMatrix4fv(f,!1,l),t.uniformMatrix4fv(p,!1,n);let o=t.getAttribLocation(i,"aVertexPosition");t.enableVertexAttribArray(o),t.bindBuffer(t.ARRAY_BUFFER,this.positionBuffer),t.vertexAttribPointer(o,3,t.FLOAT,!1,0,0);let m=t.getAttribLocation(i,"aVertexNormal");t.enableVertexAttribArray(m),t.bindBuffer(t.ARRAY_BUFFER,this.normalBuffer),t.vertexAttribPointer(m,3,t.FLOAT,!1,0,0);let b=t.getAttribLocation(i,"aTextureCoord");t.enableVertexAttribArray(b),t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer),t.vertexAttribPointer(b,2,t.FLOAT,!1,0,0),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this.texture),t.uniform1i(t.getUniformLocation(i,"uSampler"),0);let v=t.getUniformLocation(i,"affectedByLighting");t.uniform1i(v,this.affectedByLighting?1:0);const y=t.getUniformLocation(i,"ambientTopColor");t.uniform3fv(y,u.ambientLight.topColor);const w=t.getUniformLocation(i,"ambientBottomColor");t.uniform3fv(w,u.ambientLight.bottomColor);const x=t.getUniformLocation(i,"ambientLightStrength");t.uniform1f(x,u.ambientLight.strength);const E=t.getUniformLocation(i,"directionalLightColor");t.uniform3fv(E,u.directionalLight.color);const A=t.getUniformLocation(i,"directionalLightVector");t.uniform3fv(A,u.directionalLight.direction);const C=t.getUniformLocation(i,"directionalLightStrength");t.uniform1f(C,u.directionalLight.strength);const B=t.getUniformLocation(i,"pointLightColor");t.uniform3fv(B,u.pointLight.color);const k=t.getUniformLocation(i,"pointLightStrength");t.uniform1f(k,u.pointLight.strength);const P=t.getUniformLocation(i,"light1WorldPosition");t.uniform3fv(P,u.pointLight.position1);const T=t.getUniformLocation(i,"light2WorldPosition");t.uniform3fv(T,u.pointLight.position2),t.getUniformLocation(i,"usesNormalMap"),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.drawElements(this.drawMode,this.indexBuffer.number_vertex_point,t.UNSIGNED_SHORT,0)}var _,g;this.children.forEach((e=>e.draw(t,i,d,r,l,u)))}}function Rt(t,e,n,i,o){const r=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,r),t.bufferData(t.ARRAY_BUFFER,new Float32Array(e),t.STATIC_DRAW);const s=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,s),t.bufferData(t.ARRAY_BUFFER,new Float32Array(n),t.STATIC_DRAW);const a=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,a),t.bufferData(t.ARRAY_BUFFER,new Float32Array(i),t.STATIC_DRAW);const l=t.createBuffer();return l.number_vertex_point=o.length,t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,l),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(o),t.STATIC_DRAW),{glPositionBuffer:r,glNormalBuffer:s,glUVBuffer:a,glIndexBuffer:l}}function St(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))}function Lt(t,e,i,o,r,l=1){let u=[],d=[],h=[];const{positionArray:c,normalArray:f,uvArray:p}=e.getArrays(),_=function(t){let e=0,n=t[0];for(let i=1;i<t.length;i++){const o=t[i];e+=St([n[0],n[1]],[o[0],o[1]]),n=o}return e}(c);for(let t=0;t<i.length;t++){let e=n();a(e,i[t]),s(e,e);let o=c[0],r=0;for(let n=0;n<c.length;n++){const s=mt(),a=mt();yt(s,c[n],i[t]),yt(a,f[n],e),u.push(s[0],s[1],s[2]),d.push(a[0],a[1],a[2]),r+=St([o[0],o[1]],[c[n][0],c[n][1]]);const p=r/_*l,g=t%2==0?1:0;h.push(p,g),o=c[n]}}let g,m=null;[g,m]=function(t,e,n,i,o){let r=function(t){let e=mt();return t.forEach((t=>{return i=e,o=t,(n=e)[0]=i[0]+o[0],n[1]=i[1]+o[1],n[2]=i[2]+o[2],n[3]=i[3]+o[3],n;var n,i,o})),n=e,i=e,o=1/t.length,n[0]=i[0]*o,n[1]=i[1]*o,n[2]=i[2]*o,n[3]=i[3]*o,e;var n,i,o}(t),s=[],a=[];const l=[];if(i){let i=bt(0,0,-1,1);yt(i,i,n[0]),vt(i,i);let o=mt();yt(o,r,n[0]);for(let e=0;e<t.length;e++)s.push(o[0],o[1],o[2]),a.push(i[0],i[1],i[2]),l.push(.5,.5);t.forEach((t=>{const e=mt();yt(e,t,n[0]),s.push(e[0],e[1],e[2]),a.push(i[0],i[1],i[2])})),l.push(...e)}let u=[],d=[];const h=[];if(o){let i=bt(0,0,1,1);yt(i,i,n[n.length-1]),vt(i,i),t.forEach((t=>{const e=mt();yt(e,t,n[n.length-1]),u.push(e[0],e[1],e[2]),d.push(i[0],i[1],i[2])})),h.push(...e);const o=mt();yt(o,r,n[n.length-1]);for(let e=0;e<t.length;e++)u.push(o[0],o[1],o[2]),d.push(i[0],i[1],i[2]),h.push(.5,.5)}return[{positionBuffer:s,normalBuffer:a,uvBuffer:l},{positionBuffer:u,normalBuffer:d,uvBuffer:h}]}(c,p,i,o,r);let b=i.length;o&&(u=g.positionBuffer.concat(u),d=g.normalBuffer.concat(d),h=g.uvBuffer.concat(h),b+=2),r&&(u=u.concat(m.positionBuffer),d=d.concat(m.normalBuffer),h=h.concat(m.uvBuffer),b+=2);let v=function(t,e){let n=[];for(let i=0;i<t-1;i++){n.push(i*e);for(let t=0;t<e-1;t++)n.push(i*e+t),n.push((i+1)*e+t),n.push(i*e+t+1),n.push((i+1)*e+t+1);n.push((i+1)*e+e-1)}return n}(b,c.length);return Rt(t,u,d,h,v)}const Ot=.2,It=.25,Dt=20;function Nt(t,e){const n=o(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),i=o(1,0,0,0,0,1,0,0,0,0,1,0,0,0,Ot,1),r=Lt(t,new wt(It,Dt),[n,i],!0,!0);return new Mt(t.TRIANGLE_STRIP,r.glPositionBuffer,r.glNormalBuffer,r.glIndexBuffer,r.glUVBuffer,e)}class Ut{constructor(t,e,n){this.base=t,this.top=e,this.height=n}getArrays(){const t=[],e=[],i=[],o=this.base-this.top,s=o/this.base,a=n();r(a),l(a,a,Math.PI/2-Math.PI/4-Math.atan(this.height/o),[0,0,1]);const u=bt(1,0,0,1);yt(u,u,a);const d=bt(-u[0],u[1],0,1);return t.push(bt(-this.base/2,-this.height/2,0,1)),e.push(bt(0,-1,0,1)),i.push(0,0),t.push(bt(this.base/2,-this.height/2,0,1)),e.push(bt(0,-1,0,1)),i.push(1,0),t.push(bt(this.base/2,-this.height/2,0,1)),e.push(u),i.push(1,0),t.push(bt(this.top/2,this.height/2,0,1)),e.push(u),i.push(1-s,1),t.push(bt(this.top/2,this.height/2,0,1)),e.push(bt(0,1,0,1)),i.push(1-s,1),t.push(bt(-this.top/2,this.height/2,0,1)),e.push(bt(0,1,0,1)),i.push(s,1),t.push(bt(-this.top/2,this.height/2,0,1)),e.push(d),i.push(s,1),t.push(bt(-this.base/2,-this.height/2,0,1)),e.push(d),i.push(0,0),{positionArray:t,normalArray:e,uvArray:i}}}const Ft=3,Vt=2.5,Ht=.6,Gt=1,jt=2,zt=1.5,Xt=.5,Yt=.95,Wt=Gt/2.7,Kt=.2;function Jt(t,e,n="blue"){const i=new Mt,r=Nt(t,e.getTexture("black")),s=Nt(t,e.getTexture("black")),a=new Mt;r.translationVector=[0,0,-Wt-Ot],s.translationVector=[0,0,Wt],a.addChild(r),a.addChild(s),a.translationVector=[Ft/3,It,0],i.addChild(a);const l=Nt(t,e.getTexture("black")),u=Nt(t,e.getTexture("black")),d=new Mt;l.translationVector=[0,0,-Wt-Ot],u.translationVector=[0,0,Wt],d.addChild(l),d.addChild(u),d.translationVector=[-Ft/3,It,0],i.addChild(d);const h=function(t,e){let n=o(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),i=o(1,0,0,0,0,1,0,0,0,0,1,0,0,0,Gt,1);const r=Lt(t,new Ut(Ft,Vt,Ht),[n,i],!0,!0),s=new Mt(t.TRIANGLE_STRIP,r.glPositionBuffer,r.glNormalBuffer,r.glIndexBuffer,r.glUVBuffer,e);let a=o(1,0,0,0,0,1,0,0,0,0,1,0,0,0,Yt,1);const l=Lt(t,new Ut(jt,zt,Xt),[n,a],!0,!0),u=new Mt(t.TRIANGLE_STRIP,l.glPositionBuffer,l.glNormalBuffer,l.glIndexBuffer,l.glUVBuffer,e);u.translationVector=[0,Ht/2+Xt/2,0];const d=new Mt;return d.addChild(s),d.addChild(u),d}(t,e.getTexture(n));return h.translationVector=[0,Ht/2+Kt,-Gt/2],i.addChild(h),i}function Qt(t){const e=[];for(let n=0;n<t.length-1;n++)e.push(qt(t[n],t[n+1]));return e.push(function(t,e){const n=Zt(t,e),i=Et(0,1,0);return te(n,$t(n),i,e)}(t[t.length-2],t[t.length-1])),e}function qt(t,e){const n=Zt(t,e),i=Et(0,1,0);return te(n,$t(n),i,t)}function Zt(t,e){const n=Et(e[0]-t[0],0,e[1]-t[1]);return Bt(n,n),n}function $t(t){const e=xt();return kt(e,t,[0,0,0],Math.PI/2),e}function te(t,e,n,i){return o(e[0],e[1],e[2],0,n[0],n[1],n[2],0,t[0],t[1],t[2],0,i[0],0,i[1],1)}function ee(t,e){return t.map((t=>function(t,e){const o=[t[12]+e*t[0],t[13]+e*t[1],t[14]+e*t[2]],r=n();return i(r,t),r[12]=o[0],r[13]=o[1],r[14]=o[2],r}(t,e)))}class ne{constructor(t,e){this.width=t,this.height=e}getArrays(){const t=[],e=[],n=[];return t.push(bt(-this.width/2,-this.height/2,0,1)),e.push(bt(0,-1,0,1)),n.push(0,0),t.push(bt(this.width/2,-this.height/2,0,1)),e.push(bt(0,-1,0,1)),n.push(1,0),t.push(bt(this.width/2,-this.height/2,0,1)),e.push(bt(1,0,0,1)),n.push(1,0),t.push(bt(this.width/2,this.height/2,0,1)),e.push(bt(1,0,0,1)),n.push(1,1),t.push(bt(this.width/2,this.height/2,0,1)),e.push(bt(0,1,0,1)),n.push(1,1),t.push(bt(-this.width/2,this.height/2,0,1)),e.push(bt(0,1,0,1)),n.push(0,1),t.push(bt(-this.width/2,this.height/2,0,1)),e.push(bt(-1,0,0,1)),n.push(0,1),t.push(bt(-this.width/2,-this.height/2,0,1)),e.push(bt(-1,0,0,1)),n.push(0,0),{positionArray:t,normalArray:e,uvArray:n}}}class ie{constructor(t){this.pointsByDistance=new Map,this.pointsByDistance.set(0,t[0]);let e=0;for(let o=1;o<t.length;o++)e+=(n=t[o],i=t[o-1],Math.sqrt(Math.pow(n[0]-i[0],2)+Math.pow(n[1]-i[1],2))),this.pointsByDistance.set(e,t[o]);var n,i;this.totalDistance=e}getInterpolatedPoint(t){if(0===t)return this.pointsByDistance.get(0);let e=0;for(const[n,i]of this.pointsByDistance){if(t>=e&&t<=n){const o=this.pointsByDistance.get(e),r=(t-e)/(n-e);return[o[0]*(1-r)+i[0]*r,o[1]*(1-r)+i[1]*r]}e=n}throw"LUT: distance out of bounds"}getClosestPointAndIndex(t){if(0===t)return[this.pointsByDistance.get(0),0];let e=0,n=-1;for(let[i,o]of this.pointsByDistance){if(t>=e&&t<=i)return[o,n];n+=1,e=i}throw"Distance out of bounds"}getTotalDistance(){return this.totalDistance}}class oe{constructor(){this.deltaU=20,this.points=[]}setControlPoints(t){t.forEach((t=>this.points.push([t[0],t[1]])))}getPolygon(){let t=[];for(let e=0;e<this.points.length-2;e++)for(let n=0;n<this.deltaU;n++)t.push(this.getPoint(e,n/this.deltaU));return t}getPoint(t,e){let n=this.b0(e),i=this.b1(e),o=this.b2(e),r=t,s=t+1,a=t+2;return[n*this.points[r][0]+i*this.points[s][0]+o*this.points[a][0],n*this.points[r][1]+i*this.points[s][1]+o*this.points[a][1]]}b0(t){return.5*(1-t)*(1-t)}b1(t){return.5+t*(1-t)}b2(t){return.5*t*t}}const re=.2,se=20,ae=10,le=1,ue=3,de=2,he=.3;function ce(t,e){const n=function(t,e){const n=Lt(t,new Ut(ue,de,he),[o(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),o(1,0,0,0,0,1,0,0,0,0,1,0,0,0,le,1)],!0,!0),i=new Mt(t.TRIANGLE_STRIP,n.glPositionBuffer,n.glNormalBuffer,n.glIndexBuffer,n.glUVBuffer,e);return i.translationVector=[ae,se-re,-le/2],i}(t,e),i=function(t,e){const n=new wt(re),i=new oe;i.setControlPoints([[0,0],[0,0],[0,se-ae],[0,se-ae],[0,se],[ae,se],[ae,se]]);const o=Lt(t,n,Qt(i.getPolygon()),!1,!0),r=new Mt(t.TRIANGLE_STRIP,o.glPositionBuffer,o.glNormalBuffer,o.glIndexBuffer,o.glUVBuffer,e);return r.rotationAxis=[1,0,0],r.rotationDegree=-Math.PI/2,r}(t,e),r=new Mt;return r.addChild(n),r.addChild(i),r}class fe{constructor(t=1,e=8){this.radius=t,this.definition=e}getPosition(t){const e=t*Math.PI/2;return bt(this.radius*Math.cos(e),this.radius*Math.sin(e),0,1)}getArrays(){const t=1/this.definition,e=[],n=[],i=[];for(let o=0;o<=this.definition;o++){const r=this.getPosition(o*t),s=mt();vt(s,r),e.push(r),n.push(s),i.push(r[0]/this.radius+this.radius,r[1]/this.radius+this.radius)}return{positionArray:e,normalArray:n,uvArray:i}}}function pe(t,e,n,i){const r=function(t,e,n){const i=o(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),r=o(1,0,0,0,0,1,0,0,0,0,1,0,0,0,n,1),s=Lt(t,new wt(8,16),[i,r],!1,!1,2);return new Mt(t.TRIANGLE_STRIP,s.glPositionBuffer,s.glNormalBuffer,s.glIndexBuffer,s.glUVBuffer,e)}(t,e,i),s=function(t,e){const n=function(t,e,n,i,r){const s=2*Math.PI/20,a=[];for(let t=0;t<21;t++){const e=t*s,n=xt(),i=xt();kt(n,[0,0,1],[0,0,0],e),kt(i,[1,0,0],[0,0,0],e);const r=o(i[0],i[1],i[2],0,0,1,0,0,n[0],n[1],n[2],0,0,0,0,1);a.push(r)}return Lt(t,e,a,!0,!0)}(t,new fe(12));return new Mt(t.TRIANGLE_STRIP,n.glPositionBuffer,n.glNormalBuffer,n.glIndexBuffer,n.glUVBuffer,e)}(t,n);return s.rotationAxis=[1,0,0],s.rotationDegree=-Math.PI/2,s.translationVector=[0,0,i],r.addChild(s),r.rotationAxis=[1,0,0],r.rotationDegree=Math.PI/2,r}const _e=48,ge=6;function me(t,e,n){const i=Lt(t,new Ut(1,.5,1),n,!0,!0),o=new Mt(t.TRIANGLE_STRIP,i.glPositionBuffer,i.glNormalBuffer,i.glIndexBuffer,i.glUVBuffer,e);return o.translationVector=[0,3.5,0],o}const be=6,ve=6,ye=20,we=be*ve;class xe{constructor(t,e,n){this.positionArray=[],this.normalArray=[],this.uvArray=[],this.side=t,this.cornerRadius=e,this.addCornerVertices(t/2-e,-t/2+e,1.5*Math.PI,n),this.addCornerVertices(t/2-e,t/2-e,0,n),this.addCornerVertices(-t/2+e,t/2-e,Math.PI/2,n),this.addCornerVertices(-t/2+e,-t/2+e,Math.PI,n),this.positionArray.push(bt(t/2-e,-t/2,0,1)),this.normalArray.push(bt(0,-1,0,1)),this.uvArray.push(-2*(t/2-e)/this.side*n+1,-t/2*-2/this.side*n)}addCornerVertices(t,e,n,i){for(let o=0;o<=4;o++){const r=o/4*(Math.PI/2),s=Math.cos(n+r),a=Math.sin(n+r),l=t+this.cornerRadius*s,u=e+this.cornerRadius*a;this.positionArray.push(bt(l,u,0,1)),this.normalArray.push(bt(s,a,0,1)),this.uvArray.push(-2*l/this.side*i+1,-2*u/this.side*i)}}getArrays(){return{positionArray:this.positionArray,normalArray:this.normalArray,uvArray:this.uvArray}}}const Ee=.2,Ae=100,Ce=10;function Be(t,e){let n=o(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),i=o(1,0,0,0,0,1,0,0,0,0,1,0,0,0,Ee,1);const r=Lt(t,new xe(Ae,Ce,10),[n,i],!1,!0);return new Mt(t.TRIANGLE_STRIP,r.glPositionBuffer,r.glNormalBuffer,r.glIndexBuffer,r.glUVBuffer,e)}const ke=24,Pe=12,Te=4;function Me(){const t=[];for(let e=0;e<Pe;e++)t.push(Math.floor(Math.random()*(be-1))*ve+ve);return t}function Re(){const t=[];for(let e=0;e<Pe;e++)t.push(Math.floor(Math.random()*Te));return t}function Se(t,e,n,i,o){if(o)return Be(t,e.getTexture("grass"));const r=function(t,e){const n=[[-40,-40],[-20,-40],[0,-40],[20,-40],[20,-20],[20,0],[20,20],[0,20],[-20,20],[-40,20],[-40,0],[-40,-20]].map(((n,i)=>function(t,e,n=0,i=0,o=0,r=0){const s=[],a=[],l=[];let u=[];s.push(n,i,o,n,i,o,n,i,o,n+ye,i,o,n+ye,i,o,n+ye,i,o,n,i+ye,o,n,i+ye,o,n,i+ye,o,n+ye,i+ye,o,n+ye,i+ye,o,n+ye,i+ye,o,n,i,o+t,n,i,o+t,n,i,o+t,n+ye,i,o+t,n+ye,i,o+t,n+ye,i,o+t,n,i+ye,o+t,n,i+ye,o+t,n,i+ye,o+t,n+ye,i+ye,o+t,n+ye,i+ye,o+t,n+ye,i+ye,o+t),a.push(0,0,-1,0,-1,0,-1,0,0,0,0,-1,0,-1,0,1,0,0,0,0,-1,0,1,0,-1,0,0,0,0,-1,0,1,0,1,0,0,0,0,1,0,-1,0,-1,0,0,0,0,1,0,-1,0,1,0,0,0,0,1,0,1,0,-1,0,0,0,0,1,0,1,0,1,0,0);const d=t/we,h=.25*e,c=h+.25;return l.push(h,0,h,0,c,0,h,0,c,0,h,0,h,0,c,0,h,0,h,0,h,0,c,0,h,0,h,d,c,d,h,0,c,d,h,d,h,0,c,d,h,d,h,0,h,d,c,d),u.push(0,3,6,3,6,9,1,4,16,1,13,16,2,14,8,14,8,20,7,10,22,7,19,22,5,17,23,5,23,11,12,15,18,15,18,21),u=u.map((t=>t+r)),{positionBuffer:s,normalBuffer:a,uvBuffer:l,indexBuffer:u}}(t[i],e[i],n[0],n[1],Ee,i*ke))),i=[],o=[],r=[],s=[];return n.forEach((t=>{i.push(...t.positionBuffer),o.push(...t.normalBuffer),r.push(...t.uvBuffer),s.push(...t.indexBuffer)})),{positionBuffer:i,normalBuffer:o,uvBuffer:r,indexBuffer:s}}(n,i),s=Rt(t,r.positionBuffer,r.normalBuffer,r.uvBuffer,r.indexBuffer),a=new Mt(t.TRIANGLES,s.glPositionBuffer,s.glNormalBuffer,s.glIndexBuffer,s.glUVBuffer,e.getTexture("buildings")),l=Be(t,e.getTexture("sidewalk"));return l.addChild(a),l}const Le=7e3;const Oe=5e3;class Ie{levelMatrices;lookUpTable;velocity;currentDistanceTravelled=0;constructor(t,e,n=0){this.levelMatrices=ee(t,n);const i=function(t){return t.map((t=>function(t){return t.slice(12,15)}(t)))}(this.levelMatrices).map((t=>[t[0],t[2]]));this.lookUpTable=new ie(i),this.velocity=e}getNewPositionAndRotationAngle(){let t=this.currentDistanceTravelled+this.velocity;t>this.lookUpTable.getTotalDistance()&&(t-=this.lookUpTable.getTotalDistance()),this.currentDistanceTravelled=t;const e=this.lookUpTable.getInterpolatedPoint(t),n=[e[0],3,e[1]],i=this.lookUpTable.getClosestPointAndIndex(t)[1];return{newPosition:n,angle:Tt(this.levelMatrices[i].slice(8,12),[1,0,0])}}}const De=[21,12,4,4,12,21],Ne=[.5,.6,.7,.7,.6,.5];class Ue{carAnimations=[];constructor(t){const e=function(t){return t.reverse().map((t=>function(t){const e=n();return i(e,t),[0,1,2,8,9,10].forEach((t=>e[t]=-e[t])),e}(t)))}(t).reverse();this.carAnimations.push(new Ie(t,Ne[0],De[0])),this.carAnimations.push(new Ie(t,Ne[1],De[1])),this.carAnimations.push(new Ie(t,Ne[2],De[2])),this.carAnimations.push(new Ie(e,Ne[3],De[3])),this.carAnimations.push(new Ie(e,Ne[4],De[4])),this.carAnimations.push(new Ie(e,Ne[5],De[5]))}getCarsAnimationInfo(){const t=this.carAnimations.map((t=>t.getNewPositionAndRotationAngle()));for(let e=0;e<3;e++)t[e].angle=-t[e].angle;return t}}function Fe(t){return!(t&t-1)}function Ve(t,e){const n=t.createTexture();if(!n)throw Error("Failed to create texture");t.bindTexture(t.TEXTURE_2D,n),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array([0,255,0,255]));const i=new Image;return i.onload=()=>{t.bindTexture(t.TEXTURE_2D,n),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,i),Fe(i.width)&&Fe(i.height)?(t.generateMipmap(t.TEXTURE_2D),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT)):(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR))},i.src=e,n}function He(t,e,n,i){const o=t.createTexture();if(!o)throw Error("Failed to create texture");return t.bindTexture(t.TEXTURE_2D,o),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array([e,n,i,255])),o}class Ge{constructor(t){this.map=new Map,this.map.set("buildings",Ve(t,"/tp-sistemas-graficos/resources/buildings.jpg")),this.map.set("sidewalk",Ve(t,"/tp-sistemas-graficos/resources/sidewalk2.jpg")),this.map.set("sidewalkNormal",Ve(t,"/tp-sistemas-graficos/resources/sidewalk2_normal.jpg")),this.map.set("highwayRoad",Ve(t,"/tp-sistemas-graficos/resources/highway_road_wide.jpg")),this.map.set("grass",Ve(t,"/tp-sistemas-graficos/resources/grass2.jpg")),this.map.set("concrete",Ve(t,"/tp-sistemas-graficos/resources/concrete.jpg")),this.map.set("concreteWall",Ve(t,"/tp-sistemas-graficos/resources/concrete_wall.jpg")),this.map.set("skybox",Ve(t,"/tp-sistemas-graficos/resources/skybox.png")),this.map.set("street",Ve(t,"/tp-sistemas-graficos/resources/street.jpg")),this.map.set("grey",He(t,33,33,33)),this.map.set("lightGrey",He(t,189,189,189)),this.map.set("red",He(t,183,28,28)),this.map.set("green",He(t,85,139,47)),this.map.set("orange",He(t,230,81,0)),this.map.set("blue",He(t,2,119,189)),this.map.set("purple",He(t,69,39,160)),this.map.set("black",He(t,0,0,0))}getTexture(t){return this.map.get(t)}}function je(t,e,n=0,i=0,o=!1,r=1,s=0){const a=o?e:t,l=o?t:e,u=[n-a/2,i-l/2,0,n-a/2,i+l/2,0,n+a/2,i-l/2,0,n-a/2,i+l/2,0,n+a/2,i-l/2,0,n+a/2,i+l/2,0];let d;d=o?[.5,0,0,0,.5,1*r,0,0,.5,1*r,0,1*r]:[0,0,0,1*r,.5,0,0,1*r,.5,0,.5,1*r];let h=[0,1,2,3,4,5];return h=h.map((t=>t+s)),{positionBuffer:u,normalBuffer:[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1],uvBuffer:d,indexBuffer:h}}function ze(t,e=0,n=0,i=0){const o=[e-t/2,n-t/2,0,e-t/2,n+t/2,0,e+t/2,n-t/2,0,e-t/2,n+t/2,0,e+t/2,n-t/2,0,e+t/2,n+t/2,0];let r=[0,1,2,3,4,5];return r=r.map((t=>t+i)),{positionBuffer:o,normalBuffer:[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1],uvBuffer:[.5,0,.5,1,1,0,.5,1,1,0,1,1],indexBuffer:r}}const Xe=10;function Ye(){var t=new e(2);return e!=Float32Array&&(t[0]=0,t[1]=0),t}function We(t,n){var i=new e(2);return i[0]=t,i[1]=n,i}Ye();class Ke{constructor(){this.radius=500,this.alpha=Math.PI/2,this.beta=Math.PI/2,this.currentPosition=Ye(),this.previousPosition=Ye(),this.isMouseButtonPressed=!1,this.center=Et(0,0,0),this.up=Et(0,0,1),this.keysPressed={plus:!1,minus:!1}}zoomIn(){this.radius=Math.max(100,this.radius-25)}zoomOut(){this.radius=Math.min(1e3,this.radius+25)}handleMouseMove(t){this.isMouseButtonPressed&&(this.currentPosition=We(t.clientX||t.pageX,t.clientY||t.pageY))}handleMouseWheel(t){t.deltaY>0?this.zoomOut():t.deltaY<0&&this.zoomIn()}handleMouseDown(t){0===t.button&&(this.previousPosition=We(t.clientX||t.pageX,t.clientY||t.pageY),this.currentPosition=this.previousPosition,this.isMouseButtonPressed=!0)}handleMouseUp(t){0===t.button&&(this.isMouseButtonPressed=!1)}handleKeyDown(t){"="===t.key?this.keysPressed.plus=!0:"-"===t.key&&(this.keysPressed.minus=!0)}handleKeyUp(t){"="===t.key?this.keysPressed.plus=!1:"-"===t.key&&(this.keysPressed.minus=!1)}getMatrix(){const t=Ye();var e,i,o;e=t,i=this.currentPosition,o=this.previousPosition,e[0]=i[0]-o[0],e[1]=i[1]-o[1],this.previousPosition=this.currentPosition,this.alpha=this.alpha-.005*t[0],this.beta=this.beta-.005*t[1],this.beta<.01&&(this.beta=.01),this.beta>Math.PI/2&&(this.beta=Math.PI/2);const r=Et(this.radius*Math.cos(this.alpha)*Math.sin(this.beta),this.radius*Math.sin(this.alpha)*Math.sin(this.beta),this.radius*Math.cos(this.beta)),s=n();return d(s,r,this.center,this.up),s}animate(){return this.keysPressed.plus?this.zoomIn():this.keysPressed.minus&&this.zoomOut(),this.getMatrix()}}class Je{constructor(t){this.alpha=0,this.beta=0,this.currentPosition={x:0,y:0},this.previousPosition={x:0,y:0},this.handleKeyUp=t=>{"w"===t.key?this.keysPressed.w=!1:"s"===t.key?this.keysPressed.s=!1:"a"===t.key?this.keysPressed.a=!1:"d"===t.key&&(this.keysPressed.d=!1),t.shiftKey||(this.keysPressed.shift=!1)},this.targetPosition=xt(),this.playerPosition=Et(t[0],t[1],t[2]+2),this.lookAround(0,0),this.isMouseButtonPressed=!1,this.keysPressed={w:!1,a:!1,s:!1,d:!1,shift:!1}}getMatrix(){const t=this.currentPosition.x-this.previousPosition.x,e=this.currentPosition.y-this.previousPosition.y;this.previousPosition.x=this.currentPosition.x,this.previousPosition.y=this.currentPosition.y,this.lookAround(t,e);const i=n();return d(i,this.playerPosition,this.targetPosition,[0,0,1]),i}getPlayerForwardDirection(){const t=Et(this.targetPosition[0]-this.playerPosition[0],this.targetPosition[1]-this.playerPosition[1],0);return Bt(t,t),t}getPlayerRightDirection(){const t=this.getPlayerForwardDirection(),e=xt();return Pt(e,t,[0,0,0],-Math.PI/2),e}moveInDirection(t,e){Ct(t,t,e?.7:.3),At(this.playerPosition,this.playerPosition,t),At(this.targetPosition,this.targetPosition,t)}moveForward(t){const e=this.getPlayerForwardDirection();this.moveInDirection(e,t)}moveBackwards(t){const e=this.getPlayerForwardDirection(),n=xt();Ct(n,e,-1),this.moveInDirection(n,t)}moveRight(t){const e=this.getPlayerRightDirection();this.moveInDirection(e,t)}moveLeft(t){const e=this.getPlayerRightDirection(),n=xt();Ct(n,e,-1),this.moveInDirection(n,t)}lookAround(t,e){this.alpha-=.01*t,this.beta-=.01*e,this.beta>Math.PI/2?this.beta=Math.PI/2:this.beta<-Math.PI/2+.01&&(this.beta=-Math.PI/2+.01);const n=Et(0,10,0);var i,o,r,s,a,l;i=n,o=n,r=[0,0,0],s=this.beta,l=[],(a=[])[0]=o[0]-r[0],a[1]=o[1]-r[1],a[2]=o[2]-r[2],l[0]=a[0],l[1]=a[1]*Math.cos(s)-a[2]*Math.sin(s),l[2]=a[1]*Math.sin(s)+a[2]*Math.cos(s),i[0]=l[0]+r[0],i[1]=l[1]+r[1],i[2]=l[2]+r[2],Pt(n,n,[0,0,0],this.alpha),At(n,n,this.playerPosition),this.targetPosition=n}handleMouseMove(t){this.isMouseButtonPressed&&(this.currentPosition.x=t.clientX||t.pageX,this.currentPosition.y=t.clientY||t.pageY)}handleMouseDown(t){0===t.button&&(this.isMouseButtonPressed=!0,this.previousPosition.x=t.clientX||t.pageX,this.previousPosition.y=t.clientY||t.pageY,this.currentPosition.x=this.previousPosition.x,this.currentPosition.y=this.previousPosition.y)}handleMouseUp(t){0===t.button&&(this.isMouseButtonPressed=!1)}handleKeyDown(t){"w"===t.key?this.keysPressed.w=!0:"s"===t.key?this.keysPressed.s=!0:"a"===t.key?this.keysPressed.a=!0:"d"===t.key&&(this.keysPressed.d=!0),t.shiftKey&&(this.keysPressed.shift=!0)}handleMouseWheel(){}animate(){const t=this.keysPressed.shift;return this.keysPressed.w&&this.moveForward(t),this.keysPressed.a&&this.moveLeft(t),this.keysPressed.s&&this.moveBackwards(t),this.keysPressed.d&&this.moveRight(t),this.getMatrix()}}function Qe(t,e,n){let i=t.createShader(n);if(!i)throw Error(`Failed to create shader: ${n}`);return t.shaderSource(i,e),t.compileShader(i),t.getShaderParameter(i,t.COMPILE_STATUS)||console.log("Error compiling shader: "+t.getShaderInfoLog(i)),i}const qe=300,Ze=new class{constructor(t,e){this.isVisible=!1,this.container=document.getElementById(t),this.resolution=e,this.mode="agregar",this.nodeRadius=4,this.nodes=[],this.canvas=this.createCanvas(),this.container.appendChild(this.canvas),this.toolbar=this.createToolbar(),this.container.appendChild(this.toolbar),this.toolbar.addEventListener("click",(t=>{t.target instanceof HTMLElement&&"BUTTON"===t.target.tagName&&t.target.dataset.hasOwnProperty("mode")&&(this.mode=t.target.dataset.mode)})),this.currentMovingNode=null,this.canvas.addEventListener("click",(t=>{const e=Math.floor(t.clientX-this.canvas.getBoundingClientRect().left),n=Math.floor(t.clientY-this.canvas.getBoundingClientRect().top);if("agregar"===this.mode)this.addNode(e,n),this.computeCurve();else if("eliminar"===this.mode){const t=this.findNodeAt(e,n);t&&this.removeNode(t),this.computeCurve()}})),this.canvas.addEventListener("mousedown",(t=>{const e=Math.floor(t.clientX-this.canvas.getBoundingClientRect().left),n=Math.floor(t.clientY-this.canvas.getBoundingClientRect().top);"mover"===this.mode&&(this.currentMovingNode=this.findNodeAt(e,n))})),window.addEventListener("mouseup",(()=>{this.currentMovingNode=null,this.computeCurve()})),this.canvas.addEventListener("mousemove",(t=>{if(this.currentMovingNode){const e=Math.min(this.canvas.width-2*this.nodeRadius,Math.floor(t.offsetX-this.nodeRadius)),n=Math.min(this.canvas.height-2*this.nodeRadius,Math.floor(t.offsetY-this.nodeRadius));this.currentMovingNode.style.left=e+"px",this.currentMovingNode.style.top=n+"px"}}))}computeCurve(){const t=this.canvas.getContext("2d");let e=this.canvas.getBoundingClientRect();if(t.clearRect(0,0,e.width,e.height),this.nodes.length<3)return;let n=new oe,i=this.getControlPoints(),o=[];i.forEach(((t,e)=>{let n=0==e||e==i.length-1?2:1;for(let e=1;e<=n;e++)o.push(t)})),n.setControlPoints(o);let r=n.getPolygon();this.drawCurve(r)}getControlPoints(){let t=[];return this.nodes.forEach(((e,n)=>{e.getBoundingClientRect(),t.push([e.offsetLeft+e.offsetWidth/2,e.offsetTop+e.offsetHeight/2])})),t}setControlPoints(t){if(!Array.isArray(t))throw"points no es un array";t.forEach(((t,e)=>{this.addNode(t[0],t[1])})),this.computeCurve()}drawCurve(t){const e=this.canvas.getContext("2d");e.resetTransform(),e.lineWidth=3,e.strokeStyle="#00CC00",e.beginPath(),e.moveTo(t[0][0],t[0][1]);for(let n=1;n<t.length;n++)e.lineTo(t[n][0],t[n][1]);e.stroke()}createCanvas(){const t=document.createElement("canvas");return t.width=this.resolution.width,t.height=this.resolution.height,t}createToolbar(){const t=document.createElement("div");t.className="toolbar";const e=document.createElement("button");e.textContent="Agregar",e.dataset.mode="agregar";const n=document.createElement("button");n.textContent="Mover",n.dataset.mode="mover";const i=document.createElement("button");i.textContent="Eliminar",i.dataset.mode="eliminar";const o=document.createElement("button");return o.textContent="Borrar",t.appendChild(e),t.appendChild(n),t.appendChild(i),t.appendChild(o),o.addEventListener("click",this.onClickInicializar.bind(this)),t}onClickInicializar(){this.nodes.forEach(((t,e)=>this.container.removeChild(t))),this.nodes=[],this.computeCurve()}addNode(t,e){const n=document.createElement("div");n.className="node",n.style.width=2*this.nodeRadius+"px",n.style.height=2*this.nodeRadius+"px",n.style.backgroundColor="red",n.style.borderRadius="50%",n.style.position="absolute",n.style.left=t-this.nodeRadius+"px",n.style.top=e-this.nodeRadius+"px",n.style.pointerEvents="none",n.addEventListener,this.container.appendChild(n),this.nodes.push(n)}removeNode(t){this.container.removeChild(t),this.nodes=this.nodes.filter((e=>e!==t))}findNodeAt(t,e){let n=null,i=20;for(const l of this.nodes){const u=parseFloat(l.style.left),d=parseFloat(l.style.top),h=(o=t,r=e,s=u+this.nodeRadius,a=d+this.nodeRadius,Math.sqrt((o-s)**2+(r-a)**2));h<i&&(n=l,i=h)}var o,r,s,a;return n}toggleVisibility(){this.container.style.visibility=this.isVisible?"visible":"hidden",this.isVisible=!this.isVisible}}("editor-container",{width:qe,height:qe});let $e,tn;Ze.setControlPoints([[0,0],[300,50],[50,300],[300,300]]);let en=n(),nn=n(),on=n(),rn=document.getElementById("my-canvas");function sn(){requestAnimationFrame(sn),function(){(function(t,e,n,i,o){const r=new Mt;for(let s=0;s<5;s++)for(let a=0;a<5;a++){const l=Se(t,e,n[s+5*a],i[s+5*a],o[s+5*a]);l.translationVector=[(Ae+10)*(a-2),(Ae+10)*(s-2),0],r.addChild(l)}return r})($e,vn,dn,hn,fn).draw($e,tn,en,nn,on,mn),function(t,e){const n=[],i=[],o=[];let r=[];n.push(0,0,0,0,0,0,0,0,0,Oe,0,0,Oe,0,0,Oe,0,0,0,Oe,0,0,Oe,0,0,Oe,0,Oe,Oe,0,Oe,Oe,0,Oe,Oe,0,0,0,Oe,0,0,Oe,0,0,Oe,Oe,0,Oe,Oe,0,Oe,Oe,0,Oe,0,Oe,Oe,0,Oe,Oe,0,Oe,Oe,Oe,Oe,Oe,Oe,Oe,Oe,Oe,Oe,Oe),i.push(0,0,-1,0,-1,0,-1,0,0,0,0,-1,0,-1,0,1,0,0,0,0,-1,0,1,0,-1,0,0,0,0,-1,0,1,0,1,0,0,0,0,1,0,-1,0,-1,0,0,0,0,1,0,-1,0,1,0,0,0,0,1,0,1,0,-1,0,0,0,0,1,0,1,0,1,0,0),o.push(.25,1/3,.25,1/3,.25,1/3,.25,0,0,1/3,1,1/3,.5,1/3,.5,1/3,.5,1/3,.5,0,.75,1/3,.75,1/3,.25,2/3,.25,2/3,.25,2/3,.25,1,0,2/3,1,2/3,.5,2/3,.5,2/3,.5,2/3,.5,1,.75,2/3,.75,2/3),r.push(0,3,6,3,6,9,1,4,16,1,13,16,2,14,8,14,8,20,7,10,22,7,19,22,5,17,23,5,23,11,12,15,18,15,18,21);const s=Rt(t,n,i,o,r),a=new Mt,l=new Mt(t.TRIANGLES,s.glPositionBuffer,s.glNormalBuffer,s.glIndexBuffer,s.glUVBuffer,e.getTexture("skybox"),!1);return a.addChild(l),l.translationVector=[-2500,-2500,-2500],a.rotationAxis=[1,0,0],a.rotationDegree=Math.PI,a}($e,vn).draw($e,tn,en,nn,on,mn);const t=un.getCarsAnimationInfo(),e=[];for(let n=0;n<6;n++)e.push(Jt($e,vn,gn[n])),e[n].scalingVector=[2,2,2],e[n].translationVector=t[n].newPosition,e[n].rotationAxis=[0,1,0],e[n].rotationDegree=t[n].angle;const n=function(t,e,n,i,o){const r=Qt(n),s=function(t,e,n){const i=Lt(t,new ne(_e,ge),n,!0,!0,1);return new Mt(t.TRIANGLE_STRIP,i.glPositionBuffer,i.glNormalBuffer,i.glIndexBuffer,i.glUVBuffer,e)}(t,e.getTexture("highwayRoad"),r),a=me(t,e.getTexture("concrete"),r);s.addChild(a);const l=ee(r,_e/2),u=me(t,e.getTexture("concrete"),l);s.addChild(u);const d=ee(r,-_e/2),h=me(t,e.getTexture("concrete"),d);s.addChild(h);const c=function(t,e,n,i){const o=n.map((t=>[t[12],t[14]])),r=new ie(o),s=r.getTotalDistance()/(i-1),a=[];for(let o=0;o<i;o++){const i=ce(t,e),l=r.getInterpolatedPoint(s*o),u=n[r.getClosestPointAndIndex(s*o)[1]],d=Et(u[0],u[1],u[2]),h=o%2==0;i.rotationAxis=[0,1,0],i.rotationDegree=Tt(d,[0,0,1])+Math.PI/2+(h?1:0)*Math.PI,i.translationVector=[l[0],2,l[1]],a.push(i)}return a}(t,e.getTexture("lightGrey"),r,i);c.forEach((t=>s.addChild(t)));const f=function(t,e,n,i,o){const r=new ie(i),s=r.getTotalDistance()/(o-1),a=[];for(let i=0;i<o;i++){const o=pe(t,e,n,30),l=r.getInterpolatedPoint(s*i);o.translationVector=[l[0],0,l[1]],a.push(o)}return a}(t,e.getTexture("concrete"),e.getTexture("concreteWall"),n,o);return f.forEach((t=>s.addChild(t))),s}($e,vn,cn,pn,_n);n.rotationAxis=[1,0,0],n.rotationDegree=Math.PI/2,n.translationVector=[0,0,30];for(let t=0;t<6;t++)n.addChild(e[t]);n.draw($e,tn,en,nn,on,mn),function(t,e){const n=[],i=[],o=[],r=[],s=function(){const t=[],e=[],n=[],i=[];let o=0;for(let r=0;r<4;r++)for(let s=0;s<5;s++){const a=110*r-165,l=110*s-220,u=je(Xe,Ae-2*Ce,a,l,!1,8,o);t.push(...u.positionBuffer),e.push(...u.normalBuffer),n.push(...u.uvBuffer),i.push(...u.indexBuffer),o+=6;const d=je(Xe,Ae-2*Ce,l,a,!0,8,o);t.push(...d.positionBuffer),e.push(...d.normalBuffer),n.push(...d.uvBuffer),i.push(...d.indexBuffer),o+=6}return{positionBuffer:t,normalBuffer:e,uvBuffer:n,indexBuffer:i,indexBufferOffset:o}}(),a=function(t){const e=[],n=[],i=[],o=[];for(let r=0;r<4;r++)for(let s=0;s<4;s++){const a=ze(2*Ce+Xe,110*r-165,110*s-165,t);e.push(...a.positionBuffer),n.push(...a.normalBuffer),i.push(...a.uvBuffer),o.push(...a.indexBuffer),t+=6}return{positionBuffer:e,normalBuffer:n,uvBuffer:i,indexBuffer:o}}(s.indexBufferOffset);n.push(...s.positionBuffer,...a.positionBuffer),i.push(...s.normalBuffer,...a.normalBuffer),o.push(...s.uvBuffer,...a.uvBuffer),r.push(...s.indexBuffer,...a.indexBuffer);const l=Rt(t,n,i,o,r);return new Mt(t.TRIANGLES,l.glPositionBuffer,l.glNormalBuffer,l.glIndexBuffer,l.glUVBuffer,e.getTexture("street"))}($e,vn).draw($e,tn,en,nn,on,mn)}(),nn=ln.animate()}rn.width=window.innerWidth,rn.height=window.innerHeight;let an={generate:()=>{bn()},showEditor:()=>{},lights:15,columns:10};const ln=new class{constructor(){this.handleMouseDown=t=>{this.selectedCamera.handleMouseDown(t)},this.handleMouseUp=t=>{this.selectedCamera.handleMouseUp(t)},this.handleKeyDown=t=>{"1"===t.key?this.selectedCamera=this.orbitalCamera:"2"===t.key?this.selectedCamera=this.streetCamera:"3"===t.key?this.selectedCamera=this.highwayCamera:this.selectedCamera.handleKeyDown(t)},this.handleKeyUp=t=>{this.selectedCamera.handleKeyUp(t)},this.handleMouseWheel=t=>{this.selectedCamera.handleMouseWheel(t)},this.handleMouseMove=t=>{this.selectedCamera.handleMouseMove(t)},this.orbitalCamera=new Ke,this.streetCamera=new Je([0,0,0]),this.highwayCamera=new Je([0,0,32]),this.selectedCamera=this.orbitalCamera;let t=document.getElementById("my-canvas");window.addEventListener("keydown",this.handleKeyDown.bind(this)),window.addEventListener("keyup",this.handleKeyUp.bind(this)),t.addEventListener("wheel",this.handleMouseWheel.bind(this)),t.addEventListener("mousedown",this.handleMouseDown.bind(this)),t.addEventListener("mouseup",this.handleMouseUp.bind(this)),window.addEventListener("mousemove",this.handleMouseMove.bind(this))}animate(){return this.selectedCamera.animate()}};window.addEventListener("keydown",(t=>{"h"===t.key&&Ze.toggleVisibility()}));let un,dn=[],hn=[],cn=[],fn=[],pn=an.lights,_n=an.columns;const gn=["red","grey","green","orange","blue","purple"],mn={ambientLight:{topColor:[115,146,235],bottomColor:[216,197,150],strength:.5},directionalLight:{color:[252,255,181],direction:[1,2,3],strength:1.5},pointLight:{position1:[0,0,0],position2:[0,0,0],color:[255,230,146],strength:1}};function bn(){dn=function(){const t=[];for(let e=0;e<25;e++)t.push(Me());return t}(),hn=function(){const t=[];for(let e=0;e<25;e++)t.push(Re());return t}();let t=Ze.getControlPoints();t.unshift(t[0]),t.push(t[t.length-1]),t=t.map((t=>[(t[0]-150)*(560/300),(t[1]-150)*(560/300)]));const e=new oe;e.setControlPoints(t),cn=e.getPolygon(),fn=function(t){const e=[[-220,220],[-220,110],[-220,0],[-220,-110],[-220,-220],[-110,220],[-110,110],[-110,0],[-110,-110],[-110,-220],[0,220],[0,110],[0,0],[0,-110],[0,-220],[110,220],[110,110],[110,0],[110,-110],[110,-220],[220,220],[220,110],[220,0],[220,-110],[220,-220]];let n=Array(25).fill(!1);return t.map((t=>{const i=e.map((e=>{return n=e,i=t,Math.pow(n[0]-i[0],2)+Math.pow(n[1]-i[1],2);var n,i})).map((t=>t<Le));n=n.map(((t,e)=>t||i[e]))})),n}(cn),pn=Math.floor(an.lights),_n=Math.floor(an.columns),mn.pointLight.position1=[cn[0][0],-cn[0][1],50],mn.pointLight.position2=[cn[cn.length-1][0],-cn[cn.length-1][0],50];const n=Qt(cn);un=new Ue(n)}let vn;window.addEventListener("resize",(()=>{$e&&(rn.width=window.innerWidth,rn.height=window.innerHeight,$e.viewport(0,0,rn.width,rn.height),u(on,45,rn.width/rn.height,.1,1/0))})),function(){const t=new gt,e=t.addFolder("Generate");e.add(an,"generate").name("Generate Scenery"),e.open();const n=t.addFolder("Parameters");n.add(an,"lights",4,25).name("Lights"),n.add(an,"columns",4,25).name("Columns"),n.open()}(),window.onload=function(){try{$e=rn.getContext("webgl")}catch(t){alert(`Error: Your browser does not appear to support WebGL: ${t}`)}$e?($e.enable($e.DEPTH_TEST),$e.clearColor(.1,.1,.2,1),$e.clear($e.COLOR_BUFFER_BIT|$e.DEPTH_BUFFER_BIT),$e.viewport(0,0,rn.width,rn.height),u(on,45,rn.width/rn.height,.1,1/0),r(en),tn=function(t){let e=document.getElementById("shader-fs").innerHTML,n=Qe(t,document.getElementById("shader-vs").innerHTML,t.VERTEX_SHADER),i=Qe(t,e,t.FRAGMENT_SHADER),o=t.createProgram();if(!o)throw Error("Failed to create GL program");return t.attachShader(o,n),t.attachShader(o,i),t.linkProgram(o),t.getProgramParameter(o,t.LINK_STATUS)||(alert("Unable to initialize the shader program."),console.log(t.getShaderInfoLog(n)),console.log(t.getShaderInfoLog(i))),t.useProgram(o),o}($e),bn(),vn=new Ge($e),sn()):alert("Error: Your browser does not appear to support WebGL.")}})();